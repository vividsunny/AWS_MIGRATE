jQuery(document).ready(function(c){"use strict";var r={lastIndex:1,rulesContainer:!1,rulesList:!1,hasTime:!1,preNewRuleContainer:c("#yith-wcbk-availability-rules__pre-new-rule"),expandCollapseButton:c(".yith-wcbk-availability-rules__expand-collapse"),saveSettingsButton:c("#yith-wcbk-settings-tab-actions-save"),init:function(){this._initParams(),c(document).on("yith_wcbk_booking_product_duration_unit_changed",this.updateHasTime),c(document).on("click yith_wcbk_admin_booking_availability_rule_type_change",".yith-wcbk-availability-rule__type",this.changeFromToFieldsByType),c(".yith-wcbk-availability-rules__new-rule").on("click",this.preAddRule),this.preNewRuleContainer.on("click",".yith-wcbk-availability-rules__add-rule",this.addRule),c(document).on("click",".yith-wcbk-availability-rules__delete-rule",this.deleteRule),c("form#post, form#yith-wcbk-global-availability").on("submit",this.emptyPreAddRule),this.expandCollapseButton.on("click",this.expandCollapseAll),c(document).on("click",".yith-wcbk-availability-rule__days-enabled, .yith-wcbk-availability-rule__times-enabled",function(i){r.checkFieldVisibility(c(i.target))}),this.initAllRulesVisibility(),this.expandCollapseVisibility()},_initParams:function(){this.rulesContainer=c(".yith-wcbk-availability-rules").first(),this.rulesList=this.rulesContainer.find(".yith-wcbk-availability-rules__list"),this.lastIndex=this.rulesList.find(".yith-wcbk-availability-rule").length||0},initAllRulesVisibility:function(){c(".yith-wcbk-availability-rule").each(function(){r.checkFieldVisibility(c(this))})},nextIndex:function(){return++r.lastIndex},updateHasTime:function(i,e){r.hasTime=e.has_time||!1,r.initAllRulesVisibility()},changeFromToFieldsByType:function(i){var e=c(i.target).parent(),t=e.find("input[type=radio]:checked").val()||"month",l=e.closest(".yith-wcbk-availability-rule").find(".yith-wcbk-availability-rule__from-to-row"),a=l.find(".yith-wcbk-month-range-select"),n=l.find(".yith-wcbk-admin-date-picker");"custom"===t?(n.removeAttr("disabled"),a.attr("disabled","disabled"),n.parent().show()):(a.removeAttr("disabled"),n.attr("disabled","disabled"),n.parent().hide())},getRuleToAdd:function(){var i=r.preNewRuleContainer.find(".yith-wcbk-availability-rule").first();return!!i.length&&i},emptyPreAddRule:function(){r.preNewRuleContainer.html("")},preAddRule:function(i){i.preventDefault();var e,t=c(i.target);if(r.getRuleToAdd())r.preNewRuleContainer.is(".bk--open")?r.preNewRuleContainer.removeClass("bk--open").slideUp():r.preNewRuleContainer.addClass("bk--open").slideDown();else{var l,a=t.data("template"),n=r.nextIndex();r.preNewRuleContainer.hide(),a=a.replace(new RegExp("{{INDEX}}","g"),n),l=c(a),r.preNewRuleContainer.append(l),l.find(".yith-wcbk-admin-date-picker").yith_wcbk_datepicker(),r.checkFieldVisibility(l),r.preNewRuleContainer.addClass("bk--open").slideDown()}r.preNewRuleContainer.is(".bk--open")&&(e=t.offset())&&e.top&&c("html, body").animate({scrollTop:e.top-t.outerHeight()-20})},addRule:function(i){i.preventDefault();var e=c(this).closest(".yith-wcbk-availability-rule");e.find(".yith-wcbk-availability-rules__add-rule").remove(),r.rulesList.append(e),r.expandCollapseVisibility(),r.attentionForSaving()},deleteRule:function(i){i.preventDefault(),c(i.target).closest(".yith-wcbk-availability-rule").animate({opacity:.3},200).delay(200).slideUp(300,function(){c(this).remove(),r.expandCollapseVisibility(),r.attentionForSaving()})},checkFieldVisibility:function(i){var e,t,l,a,n,s,o=c(i).closest(".yith-wcbk-availability-rule");o.length&&(e=o.find(".yith-wcbk-availability-rule__days-enabled"),l=(t=o.find(".yith-wcbk-availability-rule__times-enabled")).closest(".yith-wcbk-form-field__container"),a=o.find(".yith-wcbk-availability-rule__bookable-row"),n=o.find(".yith-wcbk-availability-rule__day"),s=o.find(".yith-wcbk-availability-rule__day-time"),e.is(":checked")?(a.hide(),n.show()):(a.show(),n.hide()),e.is(":checked")&&r.hasTime?l.show():l.hide(),e.is(":checked")&&r.hasTime&&t.length&&t.is(":checked")?s.show():s.hide(),o.find(".yith-wcbk-availability-rule__type").trigger("yith_wcbk_admin_booking_availability_rule_type_change"))},expandCollapseAll:function(i){var e=c(i.target).closest(".yith-wcbk-availability-rules__expand-collapse"),t=r.rulesList;e.is(".yith-wcbk-availability-rules__expand-collapse--collapse")?(e.removeClass("yith-wcbk-availability-rules__expand-collapse--collapse"),t.find(".yith-wcbk-settings-section-box:not(.yith-wcbk-settings-section-box--closed) .yith-wcbk-settings-section-box__toggle").click()):(e.addClass("yith-wcbk-availability-rules__expand-collapse--collapse"),t.find(".yith-wcbk-settings-section-box.yith-wcbk-settings-section-box--closed .yith-wcbk-settings-section-box__toggle").click())},expandCollapseVisibility:function(){r.rulesList.find(".yith-wcbk-availability-rule").length?r.expandCollapseButton.show():r.expandCollapseButton.hide()},attentionForSaving:function(){r.saveSettingsButton.length&&(r.saveSettingsButton.removeClass("yith-wcbk-effect--wiggle"),r.saveSettingsButton.outerWidth(),r.saveSettingsButton.addClass("yith-wcbk-effect--wiggle"))}};r.init()});