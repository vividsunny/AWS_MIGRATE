jQuery(document).ready(function(d){"use strict";var r={lastIndex:1,rulesContainer:!1,rulesList:!1,preNewRuleContainer:d("#yith-wcbk-price-rules__pre-new-rule"),expandCollapseButton:d(".yith-wcbk-price-rules__expand-collapse"),saveSettingsButton:d("#yith-wcbk-settings-tab-actions-save"),init:function(){this._initParams(),d(document).on("change yith_wcbk_admin_booking_price_rule_condition_type_change",".yith-wcbk-price-rule__condition__type",this.conditionTypeChanged),d(".yith-wcbk-price-rules__new-rule").on("click",this.preAddRule),this.preNewRuleContainer.on("click",".yith-wcbk-price-rules__add-rule",this.addRule),d(document).on("click",".yith-wcbk-price-rules__delete-rule",this.deleteRule),d("form#post, form#yith-wcbk-global-price-rules").on("submit",this.emptyPreAddRule),d(document).on("click",".yith-wcbk-price-rule__conditions__new-condition",this.addCondition),d(document).on("click",".yith-wcbk-price-rule__condition__delete-condition",this.deleteCondition),this.expandCollapseButton.on("click",this.expandCollapseAll),this.checkConditionVisibility(),this.expandCollapseVisibility()},_initParams:function(){this.rulesContainer=d(".yith-wcbk-price-rules").first(),this.rulesList=this.rulesContainer.find(".yith-wcbk-price-rules__list"),this.lastIndex=this.rulesList.find(".yith-wcbk-price-rule").length||0},nextIndex:function(){return++r.lastIndex},checkConditionVisibility:function(e){((e=e||d(".yith-wcbk-price-rule__condition__type")).is(".yith-wcbk-price-rule")||e.is(".yith-wcbk-price-rule__condition"))&&(e=e.find(".yith-wcbk-price-rule__condition__type")),e.trigger("yith_wcbk_admin_booking_price_rule_condition_type_change")},conditionTypeChanged:function(e){var i,t,n=d(e.target),o=n.val()||"custom",c=n.closest(".yith-wcbk-price-rule__condition"),l={custom:c.find(".yith-wcbk-price-rule__condition--show-if-custom"),month:c.find(".yith-wcbk-price-rule__condition--show-if-month"),week:c.find(".yith-wcbk-price-rule__condition--show-if-week"),day:c.find(".yith-wcbk-price-rule__condition--show-if-day"),time:c.find(".yith-wcbk-price-rule__condition--show-if-time input"),numeric:c.find(".yith-wcbk-price-rule__condition--show-if-numeric")},r=["custom","month","week","day","time","numeric"],s=function(e,i){return-1!==d.inArray(e,i)};if(s(o,["custom","month","week","day","time","numeric"])){for(i in r)o!==(t=r[i])&&(l[t].attr("disabled","disabled"),s(t,["custom","time"])?l[t].parent().hide():l[t].hide());l[o].removeAttr("disabled"),s(o,["custom","time"])?l[o].parent().show():l[o].show()}else l.custom.attr("disabled","disabled"),l.month.attr("disabled","disabled"),l.week.attr("disabled","disabled"),l.day.attr("disabled","disabled"),l.time.attr("disabled","disabled"),l.custom.parent().hide(),l.month.hide(),l.week.hide(),l.day.hide(),l.time.parent().hide(),l.numeric.removeAttr("disabled"),l.numeric.show()},getRuleToAdd:function(){var e=r.preNewRuleContainer.find(".yith-wcbk-price-rule").first();return!!e.length&&e},emptyPreAddRule:function(){r.preNewRuleContainer.html("")},preAddRule:function(e){e.preventDefault();var i,t=d(e.target);if(r.getRuleToAdd())r.preNewRuleContainer.is(".bk--open")?r.preNewRuleContainer.removeClass("bk--open").slideUp():r.preNewRuleContainer.addClass("bk--open").slideDown();else{var n,o=t.data("template"),c=r.nextIndex();r.preNewRuleContainer.hide(),o=o.replace(new RegExp("{{INDEX}}","g"),c),n=d(o),r.preNewRuleContainer.append(n),n.find(".yith-wcbk-admin-date-picker").yith_wcbk_datepicker(),r.checkConditionVisibility(n),d(document).trigger("yith_wcbk_product_metabox_dynamic_durations"),r.preNewRuleContainer.addClass("bk--open").slideDown()}r.preNewRuleContainer.is(".bk--open")&&(i=t.offset())&&i.top&&d("html, body").animate({scrollTop:i.top-t.outerHeight()-20})},addRule:function(e){e.preventDefault();var i=d(this).closest(".yith-wcbk-price-rule");i.find(".yith-wcbk-price-rules__add-rule").remove(),r.rulesList.append(i),r.expandCollapseVisibility(),r.attentionForSaving()},deleteRule:function(e){e.preventDefault(),d(e.target).closest(".yith-wcbk-price-rule").animate({opacity:.3},200).delay(200).slideUp(300,function(){d(this).remove(),r.expandCollapseVisibility(),r.attentionForSaving()})},addCondition:function(e){e.preventDefault();var i,t=d(e.target),n=wp.template("yith-wcbk-price-rule-condition"),o=t.closest(".yith-wcbk-price-rule__conditions").find(".yith-wcbk-price-rule__conditions__list"),c=t.closest(".yith-wcbk-price-rule").data("index")||1,l=1;o.data("last-index")?l=o.data("last-index")+1:(l=o.find(".yith-wcbk-price-rule__condition").length||0,l+=1),o.data("last-index",l),i=d(n({ruleIndex:c,conditionIndex:l})),o.append(i),i.find(".yith-wcbk-admin-date-picker").yith_wcbk_datepicker(),r.checkConditionVisibility(i)},deleteCondition:function(e){e.preventDefault(),d(e.target).closest(".yith-wcbk-price-rule__condition").remove()},expandCollapseAll:function(e){var i=d(e.target).closest(".yith-wcbk-price-rules__expand-collapse"),t=r.rulesList;i.is(".yith-wcbk-price-rules__expand-collapse--collapse")?(i.removeClass("yith-wcbk-price-rules__expand-collapse--collapse"),t.find(".yith-wcbk-settings-section-box:not(.yith-wcbk-settings-section-box--closed) .yith-wcbk-settings-section-box__toggle").click()):(i.addClass("yith-wcbk-price-rules__expand-collapse--collapse"),t.find(".yith-wcbk-settings-section-box.yith-wcbk-settings-section-box--closed .yith-wcbk-settings-section-box__toggle").click())},expandCollapseVisibility:function(){r.rulesList.find(".yith-wcbk-price-rule").length?r.expandCollapseButton.show():r.expandCollapseButton.hide()},attentionForSaving:function(){r.saveSettingsButton.length&&(r.saveSettingsButton.removeClass("yith-wcbk-effect--wiggle"),r.saveSettingsButton.outerWidth(),r.saveSettingsButton.addClass("yith-wcbk-effect--wiggle"))}};r.init()});