jQuery(document).ready(function(D){"use strict";D.fn.yith_wcbk_serializeFormJSON=function(){var i={},t=this.serializeArray();return D.each(t,function(){i[this.name]?(i[this.name].push||(i[this.name]=[i[this.name]]),i[this.name].push(this.value||"")):i[this.name]=this.value||""}),i},D.fn.yith_booking_form=function(){var l=D(this).closest(".yith-wcbk-booking-form"),b=l.data("product-id"),u=l.data("booking_data"),k=l.find(".yith-wcbk-booking-duration"),f=0<k.length,p=l.find(".yith-wcbk-booking-persons"),y=(p.length,"hour"===u.duration_unit||"minute"===u.duration_unit),w=l.find(".yith-wcbk-booking-person-types"),v=0<w.length,x=l.find("input[type=checkbox].yith-wcbk-booking-service"),M=0<x.length,S=l.find("input.yith-wcbk-booking-service-quantity"),j=l.find(".yith-wcbk-booking-start-date"),I=l.find(".yith-wcbk-booking-hidden-from"),A=l.find(".yith-wcbk-booking-end-date"),C=l.find(".yith-wcbk-booking-form-message"),F=l.find(".yith-wcbk-booking-form-totals"),N=l.find(".yith-wcbk-booking-form-additional-data"),O={messages:[],addMessage:function(i){this.messages.push(i)},getMessages:function(i){var t=this.messages;return(i=i||1)&&this.resetMessages(),t},resetMessages:function(){this.messages=[]},hasMessages:function(){return!!this.messages.length},showAll:function(){for(var i=this.getMessages(),t="",e=0;i[e];e++)t+=i[e];C.html(t)},showFirst:function(){var i=this.getMessages(0),t="";0<i.length&&(t=i.shift()),C.html(t)},hideMessages:function(){C.html("")}},q=l.find(".yith-wcbk-booking-start-date-time"),i=l.closest(yith_booking_form_params.dom.product_container).find(yith_booking_form_params.dom.price),z="yes"!==yith_booking_form_params.price_first_only?i:i.first(),B=l.closest("form").find("button[type=submit]"),P={message:bk.loader_svg,blockMsgClass:"yith-wcbk-block-ui-element",css:{border:"none",background:"transparent"},overlayCSS:{background:"#fff",opacity:.7},ignoreIfBlocked:!0},T={message:null,overlayCSS:{opacity:0},ignoreIfBlocked:!0},J=function(i,t,e){return isNaN(i)&&(i=0),i<2?t:e},Q=null;B.attr("disabled",!0),l.on("yith_wcbk_booking_form_update",function(){var i=k.val(),t=p.val(),e=j.val(),o=e,a=A.val(),n=0,r=q.val(),s="",_=!0,m={};if(0<I.length&&(r?I.val(e+" "+r):I.val(e),o=I.val()),v?w.each(function(){n+=D(this).val()<1?0:parseInt(D(this).val())}):n=t<1?0:parseInt(t),!i&&f&&(s+=yith_booking_form_params.i18n_empty_duration+"<br />",_=!1),(!e||0<A.length&&!a)&&("yes"===yith_booking_form_params.show_empty_date_time_messages&&(s+=y?yith_booking_form_params.i18n_empty_date_for_time+"<br />":yith_booking_form_params.i18n_empty_date+"<br />"),_=!1),y&&e&&!r&&("yes"===yith_booking_form_params.show_empty_date_time_messages&&(s+=yith_booking_form_params.i18n_empty_time+"<br />"),_=!1),n<u.minimum_number_of_people&&(s+=yith_booking_form_params.i18n_min_persons.replace(/%s/g,u.minimum_number_of_people)+"<br />",_=!1),0<u.maximum_number_of_people&&n>u.maximum_number_of_people&&(s+=yith_booking_form_params.i18n_max_persons.replace(/%s/g,u.maximum_number_of_people)+"<br />",_=!1),o&&a&&"day"===u.duration_unit){if(i=yith_wcbk_dates.date_diff(a,o,"days"),"yes"===u.full_day&&(i+=1),0<u.minimum_duration&&i<u.minimum_duration){var c=J(u.minimum_duration,yith_booking_form_params.i18n_days.singular,yith_booking_form_params.i18n_days.plural).replace(/%s/g,u.minimum_duration);s+=yith_booking_form_params.i18n_min_duration.replace(/%s/g,c)+"<br />",_=!1}if(0<u.maximum_duration&&i>u.maximum_duration){var h=J(u.maximum_duration,yith_booking_form_params.i18n_days.singular,yith_booking_form_params.i18n_days.plural).replace(/%s/g,u.maximum_duration);s+=yith_booking_form_params.i18n_max_duration.replace(/%s/g,h)+"<br />",_=!1}}if(_){C.block(P),z.block(P),B.block(T);var g=[],d=[];v&&w.each(function(){var i=D(this).data("person-type-id"),t=D(this).val();g.push({id:i,number:t})}),M&&x.each(function(){if(D(this).is(":checked")){var i=D(this).data("service-id");d.push(i)}}),m={product_id:b,duration:i,from:o,time:r,to:a,persons:t,person_types:g,booking_services:d,action:"yith_wcbk_get_booking_data",context:"frontend"},S.length&&S.each(function(){var i=D(this).attr("name"),t=D(this).val();i.length&&(m[i]=t)}),N.length&&N.each(function(){var i=D(this).attr("name"),t=D(this).val();i.length&&(m[i]=t)}),Q&&Q.abort(),Q=D.ajax({type:"POST",data:m,url:yith_booking_form_params.ajaxurl,success:function(i){try{i.error?O.addMessage('<p class="error">'+i.error+"</p>"):(i.message&&O.addMessage(i.message),i.totals_html?F.html(i.totals_html):F.html(""),i.price&&0<i.price.length&&z.html(i.price),i.is_available?B.attr("disabled",!1):B.attr("disabled",!0),l.trigger("yith_wcbk_form_update_response",i))}catch(t){console.log(t.message)}},complete:function(i,t){"abort"!==t&&(O.showFirst(),C.unblock(),B.unblock(),z.unblock())}})}else s&&O.addMessage("<p>"+s+"</p>"),O.hasMessages()?O.showAll():(O.resetMessages(),O.hideMessages()),B.attr("disabled",!0)}),l.on("change","input, select, .yith-wcbk-date-picker--inline",function(i){var t=D(i.target),e=k.val(),o=j.val(),a=q.val(),n={};if(y&&o&&e&&(t.is(".yith-wcbk-booking-start-date")||t.is(".yith-wcbk-booking-duration")))return q.parent().block(P),n={product_id:b,duration:e,from:o,action:"yith_wcbk_get_booking_available_times",context:"frontend"},Q&&Q.abort(),Q=D.ajax({type:"POST",data:n,url:yith_booking_form_params.ajaxurl,success:function(i){try{if(i.error)O.addMessage('<p class="error">'+i.error+"</p>");else{if(i.time_data_html&&q.html(i.time_data_html),a){var t=q.find('option[value="'+a+'"]');t&&t.attr("selected","selected")}i.message&&O.addMessage("<p>"+i.message+"</p>"),l.trigger("yith_wcbk_form_update_time",i)}}catch(e){console.log(e)}},complete:function(){q.parent().unblock(),l.trigger("yith_wcbk_booking_form_update")}}),!1;l.trigger("yith_wcbk_booking_form_update")}),l.on("yith_wcbk_booking_form_loaded",function(){0<j.val().length?j.trigger("change"):"yes"===yith_booking_form_params.update_form_on_load&&l.trigger("yith_wcbk_booking_form_update")}),!yith_booking_form_params.is_admin&&"yes"===yith_booking_form_params.ajax_update_non_available_dates_on_load&&j.is(".yith-wcbk-date-picker")?(j.parent().block(P),j.trigger("yith_wcbk_datepicker_load_non_available_dates",{callback:function(){j.parent().unblock(),l.trigger("yith_wcbk_booking_form_loaded")}})):l.trigger("yith_wcbk_booking_form_loaded")},D(document).on("yith-wcbk-init-booking-form",function(){var i=D(".yith-wcbk-date-picker"),t=D(".yith-wcbk-booking-form"),e=D(".yith-wcbk-people-selector"),o=D(".yith-wcbk-month-picker-wrapper");i.yith_wcbk_datepicker(),o.yith_wcbk_monthpicker(),e.each(function(){D(this).yith_wcbk_people_selector()}),t.each(function(){D(this).yith_booking_form()}),D(document).trigger("yith-wcbk-booking-form-loaded")}).trigger("yith-wcbk-init-booking-form"),D(document).on("qv_loader_stop",function(){D(document).trigger("yith-wcbk-init-booking-form")})});