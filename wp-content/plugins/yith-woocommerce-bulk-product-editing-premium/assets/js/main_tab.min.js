jQuery(function(f){var e,t=f("#yith-wcbep-categories-filter"),b=f("#yith-wcbep-table-wrap .wp-list-table"),i=f("#yith-wcbep-custom-input"),n=null,r=null,c=new Array,_=new Array,w=new Array,p=new Array,g=f("#yith-wcbep-get-products"),a=f("#yith-wcbep-filter-form"),l=f("#yith-wcbep-categories-filter"),o=f("#yith-wcbep-regular-price-filter-select"),s=f("#yith-wcbep-regular-price-filter-value"),h=f("#yith-wcbep-sale-price-filter-select"),u=f("#yith-wcbep-sale-price-filter-value"),d=f("#yith-wcbep-per-page-filter"),y=f("#yith-wcbep-reset-filters"),v=(f("#yith-wcbep-table-wrap"),f("#yith-wcbep-bulk-edit-btn")),m=f("#yith-wcbep-bulk-editor"),k=f("#yith-wcbep-bulk-apply"),x=(f("#yith-wcbep-regular-price-bulk-select"),f("#yith-wcbep-regular-price-bulk-value"),f("#yith-wcbep-sale-price-bulk-select"),f("#yith-wcbep-sale-price-bulk-value"),f("#yith-wcbep-save")),A=new Array,N=new Array,j=(f("#yith-wcbep-message"),{message:null,overlayCSS:{background:"#000",opacity:.6},ignoreIfBlocked:!0}),F={message:null,overlayCSS:{background:"#000 url()",opacity:.6,cursor:"default"}},T=function(e){(e=e||!1)&&i.hide(),n&&(n.html(i.html()),i.html(""),n=null),O()},I=[],O=function(e){var n=0;I=[],N=[],b.find("tbody#the-list > tr").each(function(){var e=f(this).children("td"),t=!1;if(0<e.length){var a=1,i=[];i.push(0),e.each(function(){f(this).html()!=c[n][a]?(f(this).addClass("yith-wcbep-table-modified-td"),t=!0,i.push(1)):(f(this).removeClass("yith-wcbep-table-modified-td"),i.push(0)),a++}),I.push(i),t&&N.push(n),n++}}),e&&create_current_html_matrix()},S=function(){c=new Array,p=new Array,b.find("tbody tr").each(function(){var e=f(this).find("td"),t=[f(this).find("th")];if(0<e.length){var a=[!1];e.each(function(){a.push(f(this).html()),t.push(f(this))}),c.push(a),p.push(t)}})},C=function(){m.find("input.is_resetable").each(function(){f(this).val("")}),m.find("select.is_resetable").each(function(){f(this).prop("selectedIndex",0)})},R=function(){if(r)for(index in p){var e=p[index];for(index_col in e)if(f(e[index_col])[0]==r[0]&&"undefined"!=typeof p[parseInt(index)+1])return f(p[parseInt(index)+1][index_col]).trigger("click"),void i.selectText()}};f.fn.selectText=function(){var e=document,t=this[0];if(e.body.createTextRange)(a=document.body.createTextRange()).moveToElementText(t),a.select();else if(window.getSelection){var a,i=window.getSelection();(a=document.createRange()).selectNodeContents(t),i.removeAllRanges(),i.addRange(a)}},t.select2({width:"95%"}),i.offset(new Array(0,0)),e=new Array,b.find("thead tr th").each(function(){e.push(f(this).attr("id"))}),w=e,m.draggable(),f("html").on("click",function(){T(!0)}),i.on("click",function(e){e.stopPropagation()}).keypress(function(e){13==e.which&&(T(!0),e.stopPropagation(),setTimeout(R,0))}),g.on("click",function(){var e={f_categories:l.val(),f_reg_price_select:o.val(),f_reg_price_value:s.val(),f_sale_price_select:h.val(),f_sale_price_value:u.val(),f_per_page:d.val()};list.update(e)}),v.on("click",function(){var e,t,a=b.find("tbody th input:checked"),i=new Array;(a.each(function(){i.push(f(this).val())}),i.length<1)?alert(ajax_object.no_product_selected):(m.fadeIn(),f("#wpwrap").block(F),e=0,t=new Array,b.find("tbody tr").each(function(){0<f(this).find("th input:checked").length&&t.push(e),e++}),A=t)}),f("#yith-wcbep-bulk-cancel").add(".yith-wcbep-close-bulk-editor").on("click",function(){m.fadeOut(),C(),f("#wpwrap").unblock()}),m.keypress(function(e){13==e.which&&k.trigger("click")}),k.on("click",function(){for(var e in A){var t=A[e],a=["regular_price","sale_price"];for(var i in a)if(-1<w.indexOf(a[i])){var n=f(p[t][w.indexOf(a[i])]),r=parseFloat(n.html()),c="",l=f("#yith-wcbep-"+a[i]+"-bulk-select").val(),o=f("#yith-wcbep-"+a[i]+"-bulk-value").val();if((!isNaN(o)&&""!=o||"del"==l)&&n.find(".not_editable").length<1){switch(l){case"new":c=parseFloat(o);break;case"inc":c=(r=isNaN(r)?0:r)+parseFloat(o);break;case"dec":c=0<r?r-parseFloat(o):"";break;case"incp":c=0<r?r+r*parseFloat(o)/100:"";break;case"decp":c=0<r?r-r*parseFloat(o)/100:"";break;case"decfr":var s=f(p[t][w.indexOf("regular_price")]);r=parseFloat(s.html()),isNaN(r)||""==r||(c=r-parseFloat(o));break;case"decpfr":s=f(p[t][w.indexOf("regular_price")]);r=parseFloat(s.html()),isNaN(r)||""==r||(c=r-r*parseFloat(o)/100);break;case"del":c=""}""!=c&&(c<0||isNaN(c))&&(c=0),n.html(c)}}}m.fadeOut(),C(),f("#wpwrap").unblock()}),y.on("click",function(){a.find("input.is_resetable").each(function(){f(this).val("")}),a.find("select.is_resetable").each(function(){f(this).prop("selectedIndex",0)}),t.val("").trigger("change")}),x.on("click",function(){if(O(),0<N.length){b.block(j),x.prop("disabled",!0),v.prop("disabled",!0),d=new Array,b.find("tbody tr").each(function(){var e=f(this).find("td");if(0<e.length){var t=[!1];e.each(function(){t.push(f(this).html())}),d.push(t)}}),_=d;var a=[],i=[];for(var e in N){var t=N[e];a.push(_[t]),i.push(I[t])}for(var n in i){var r=i[n];for(ic in r){0==r[ic]&&2!=ic&&(a[n][ic]=null)}}var c=a.length,l=c,o=0,s=f("#yith-wcbep-percentual-container");s.html('<span class="yith-wcbep-percentual" style="width:'+o+'%;">'+o+"%</span>");var p=s.find("span.yith-wcbep-percentual");s.fadeIn();var h=a.length,u=function(t){if(t<h){var e={matrix_keys:w,matrix_modify:[a[t]],edited_matrix:[i[t]],action:"yith_wcbep_bulk_edit_products"};f.ajax({type:"POST",data:e,url:ajaxurl,success:function(e){0},complete:function(e){c--,o=parseInt(100*(l-c)/l),p.html(o+"%"),p.animate({width:o+"%"},200),u(++t)}})}else g.trigger("click"),s.delay(1500).fadeOut()};0<h&&u(0)}var d}),list={init:function(){var a;b=f("#yith-wcbep-table-wrap .wp-list-table"),S(),b.find("th#cb input").on("click",function(){var e=b.find("tbody#the-list th.check-column > input");f(this).is(":checked")?e.attr("checked",!0):e.attr("checked",!1)}),b.on("click","td.regular_price, td.sale_price",function(e){e.stopPropagation(),T(!1),n=f(e.target),r=f(e.target),i.width(n.width()),i.height(n.height()),i.show(),i.offset(n.offset()),i.html(n.html())}),f(".tablenav-pages a, .manage-column.sortable a, .manage-column.sorted a").on("click",function(e){e.preventDefault();var t=this.search.substring(1),a={paged:list.__query(t,"paged")||"1",order:list.__query(t,"order")||"asc",orderby:list.__query(t,"orderby")||"date",f_categories:l.val(),f_reg_price_select:o.val(),f_reg_price_value:s.val(),f_sale_price_select:h.val(),f_sale_price_value:u.val(),f_per_page:d.val()};list.update(a)}),f("input[name=paged]").on("keyup",function(e){13==e.which&&e.preventDefault();var t={paged:parseInt(f("input[name=paged]").val())||"1",order:f("input[name=order]").val()||"asc",orderby:f("input[name=orderby]").val()||"date"};window.clearTimeout(a),a=window.setTimeout(function(){list.update(t)},500)})},update:function(e){b.block(j),x.prop("disabled",!0),v.prop("disabled",!0),f.ajax({url:ajaxurl,data:f.extend({_ajax_yith_wcbep_list_nonce:f("#_ajax_yith_wcbep_list_nonce").val(),action:"_ajax_fetch_yith_wcbep_list"},e),success:function(e){(e=f.parseJSON(e)).rows.length&&f("#the-list").html(e.rows),e.column_headers.length&&f("thead tr, tfoot tr").html(e.column_headers),e.pagination.bottom.length&&f(".tablenav.top .tablenav-pages").html(f(e.pagination.top).html()),e.pagination.top.length&&f(".tablenav.bottom .tablenav-pages").html(f(e.pagination.bottom).html()),list.init(),b.unblock(),x.prop("disabled",!1),v.prop("disabled",!1),S()}})},__query:function(e,t){for(var a=e.split("&"),i=0;i<a.length;i++){var n=a[i].split("=");if(n[0]==t)return n[1]}return!1}},list.init()});