!function(d,c,h,f){var e="YLC",s={app_id:"",api_key:"",display_login:!0,user_info:{user_id:null,user_name:null,user_email:null,gravatar:null,user_type:null,avatar_type:null,avatar_image:null,current_page:null,user_ip:null},styles:{bg_color:"#009EDB",x_pos:"right",y_pos:"bottom",border_radius:"5px 5px 0 0",popup_width:370,btn_width:260,btn_height:0,btn_type:"classic",form_width:260,animation_type:"bounceIn",autoplay:!0,autoplay_delay:1e3}},l=null,i={end_chat_frontend:function(t){if(t){var e=new Date;this.trigger_premium("save_user_data",this.data.user.conversation_id,!0,e.getTime(),!0)}},premium_frontend:function(){var a=this,n=!1,s=!1,t=!1;if(d(h).on("click","#YLC_send_btn",function(){if(n)return!1;if(ylc.gdpr&&!d("#YLC_gdpr_acceptance").is(":checked"))return a.display_ntf(a.strings.msg.field_empty,"error","#YLC_offline_ntf"),!1;a.display_ntf(a.strings.msg.sending+"...","sending ","#YLC_offline_ntf");var t=d("#YLC_popup_form").serializeArray(),i=t.length-1;return d.each(t,function(t,e){if(a.data.current_form[e.name]=e.value,!e.value)return a.display_ntf(a.strings.msg.field_empty,"error","#YLC_offline_ntf"),!1;if("email"===e.name){if(!a.validate_email(e.value))return a.display_ntf(a.strings.msg.invalid_email,"error","#YLC_offline_ntf"),!1}else if("name"===e.name&&!a.validate_username(e.value))return a.display_ntf(a.strings.msg.invalid_username,"error","#YLC_offline_ntf"),!1;if(t===i){n=!0;var s=d("#YLC_popup_form").serialize()+"&vendor_id="+ylc.active_vendor.vendor_id;a.post("ylc_ajax_offline_form",s,function(t){n=!1,t.error?a.display_ntf(t.error,"error","#YLC_offline_ntf"):t.warn?(a.display_ntf(t.warn,"success","#YLC_offline_ntf"),setTimeout(function(){a.clean_ntf(),a.minimize()},4e3)):(a.display_ntf(t.msg,"success","#YLC_offline_ntf"),setTimeout(function(){a.clean_ntf(),a.minimize()},2e3))})}}),!1}),d(h).on("mouseenter","#YLC_send_btn",function(){d(this).css("background-color",a.data.primary_hover)}),d(h).on("mouseleave","#YLC_send_btn",function(){d(this).css("background-color",a.opts.styles.bg_color)}),d(h).on("click","#YLC_good_btn, #YLC_bad_btn",function(){if(s)return!1;s=!0,a.display_ntf(a.strings.msg.sending+"...","sending","#YLC_end_chat_ntf");var t="YLC_good_btn"===d(this).attr("id")?"good":"bad",e=d("#YLC_request_chat").is(":checked")?1:0;return a.post("ylc_ajax_chat_evaluation",{conversation_id:a.data.user.conversation_id,evaluation:t,receive_copy:e,user_email:a.data.user.user_email,chat_with:a.data.user.chat_with},function(){s=!1}),a.minimize(),!1}),d(h).on("click","#YLC_chat_request",function(){if(t)return!1;t=!0,a.display_ntf(a.strings.msg.sending+"...","sending","#YLC_end_chat_ntf");return a.post("ylc_ajax_chat_evaluation",{conversation_id:a.data.user.conversation_id,evaluation:"",receive_copy:1,user_email:a.data.user.user_email,chat_with:a.data.user.chat_with},function(){t=!1}),a.minimize(),!1}),"round"===this.opts.styles.btn_type){var e=this.opts.styles.btn_width/2;d("#YLC_chat_btn.btn-round").css({color:this.data.primary_fg,"background-color":this.opts.styles.bg_color,width:this.opts.styles.btn_width+"px",height:this.opts.styles.btn_width+"px","-webkit-border-radius":e+"px","-moz-border-radius":e+"px","border-radius":e+"px",right:"right"===this.opts.styles.x_pos?"20px":"auto",left:"right"===this.opts.styles.x_pos?"auto":"20px",top:"top"===this.opts.styles.y_pos?"20px":"auto",bottom:"top"===this.opts.styles.y_pos?"auto":"20px"}),d("#YLC_chat_btn .chat-ico.chat").css({width:this.opts.styles.btn_width+"px"}),d("#YLC_chat_btn div").css({"line-height":this.opts.styles.btn_width+"px"})}else d("#YLC_chat_btn").css({color:this.data.primary_fg,"background-color":this.opts.styles.bg_color,width:this.opts.styles.btn_width+"px","-webkit-border-radius":this.opts.styles.border_radius,"-moz-border-radius":this.opts.styles.border_radius,"border-radius":this.opts.styles.border_radius,right:"right"===this.opts.styles.x_pos?"20px":"auto",left:"right"===this.opts.styles.x_pos?"auto":"20px",top:"top"===this.opts.styles.y_pos?"0":"auto",bottom:"top"===this.opts.styles.y_pos?"auto":"0"});d("#YLC_chat").css({"-webkit-border-radius":this.opts.styles.border_radius,"-moz-border-radius":this.opts.styles.border_radius,"border-radius":this.opts.styles.border_radius,right:"right"===this.opts.styles.x_pos?"40px":"auto",left:"right"===this.opts.styles.x_pos?"auto":"40px",top:"top"===this.opts.styles.y_pos?"0":"auto",bottom:"top"===this.opts.styles.y_pos?"auto":"0"}),d("#YLC_chat_header").css({color:this.data.primary_fg,"background-color":this.opts.styles.bg_color}),d(".chat-form-btn").css({color:this.data.primary_fg,"background-color":this.opts.styles.bg_color}),"bottom"!==this.opts.styles.y_pos&&d(".chat-body").css({"-webkit-border-radius":this.opts.styles.border_radius,"-moz-border-radius":this.opts.styles.border_radius,"border-radius":this.opts.styles.border_radius})},chat_duration:function(t,e){if(""===e||""===t)return"00:00:00";var s=.001*(e-t)>>0,i=s/60>>0,a=i/60>>0;return(a=(a%=60)<10?"0"+a:a)+":"+(i=(i%=60)<10?"0"+i:i)+":"+(s=(s%=60)<10?"0"+s:s)},save_user_data:function(o,_,a,u,l){var c=this;this.data.ref_cnv.child(o).once("value",function(t){var e=null!==t.val(),s=t.val();if(e){var r=s.user_id,i=c.trigger_premium("chat_duration",s.accepted_at,a);c.data.ref_users.child(r).once("value",function(t){var n=t.val();n.created_at=s.created_at,n.evaluation=s.evaluation,n.duration=i,n.receive_copy=s.receive_copy,n.send_email=u,c.data.ref_msgs.once("value",function(t){var e=t.val(),s=e?Object.keys(e).length:0,i=0,a={};e?d.each(e,function(t,e){i+=1,e.conversation_id===o&&(a[t]=e,_&&c.data.ref_msgs.child(t).remove()),s===i&&(n.msgs=a,c.post("ylc_ajax_save_chat",n,function(t){l&&l(t)}))}):l&&l({}),_&&(c.data.ref_users.child(r).remove(),c.data.ref_cnv.child(o).remove())})})}else l&&l({})})},set_avatar_premium:function(t,e){var s;if("admin"!==t)s="https://www.gravatar.com/avatar/"+e.gravatar+".jpg?s=60&d="+ylc.default_user_avatar;else switch(e.avatar_type){case"gravatar":s="https://www.gravatar.com/avatar/"+e.gravatar+".jpg?s=60&d="+ylc.default_admin_avatar;break;case"image":s=e.avatar_image;break;default:s=""!==ylc.company_avatar?ylc.company_avatar:this.data.assets_url+"/images/default-avatar-"+t+".png"}return s},logged_users_auth:function(){""!==this.opts.user_info.user_name&&""!==this.opts.user_info.user_email&&(d("#YLC_field_name").val(this.opts.user_info.user_name),d("#YLC_msg_name").val(this.opts.user_info.user_name),d("#YLC_field_email").val(this.opts.user_info.user_email),d("#YLC_msg_email").val(this.opts.user_info.user_email))},autoplay:function(){0<this.opts.styles.autoplay_delay&&setTimeout(function(){d("#YLC_chat_btn").click()},this.opts.styles.autoplay_delay)}};function t(t){this.element=t,this.opts=d.extend(s,ylc.defaults),this.premium=d.extend({},i),this._name=e,this.init()}t.prototype={init:function(){this.data={auth:null,ref:null,is_mobile:!1,active_user_id:0,mode:"offline",logged:!1,assets_url:ylc.plugin_url,animation_delay:1e3,show_delay:ylc.show_delay,guest_prefix:"Guest-",primary_fg:null,primary_hover:null,popup_status:"close",user:{},current_form:{},online_ops:{}},this.strings=ylc.strings,this.objs={btn:null,popup:null,popup_header:null,cnv:null};var e=this;this.trigger_premium("logged_users_auth"),this.trigger_premium("premium_frontend"),/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(this.data.is_mobile=!0),this.post("ylc_ajax_get_token",{},function(t){t.error||(e.data.auth_token=t.token,e.render_chat(),e.trigger_premium("autoplay"))})},auth:function(t){if(this.opts.app_id){if(null===this.data.ref){var e={apiKey:this.opts.api_key,authDomain:this.opts.app_id+".firebaseapp.com",databaseURL:"https://"+this.opts.app_id+".firebaseio.com"};firebase.initializeApp(e),this.data.ref=firebase.database().ref(),this.data.ref_conn=firebase.database().ref(".info/connected"),this.data.ref_cnv=firebase.database().ref("chat_sessions"),this.data.ref_msgs=firebase.database().ref("chat_messages"),this.data.ref_users=firebase.database().ref("chat_users")}this.opts.display_login?this.login(!1,t):this.login(!0,t)}else console.error("App ID not provided")},login:function(t,_){var u=this;this.purge_firebase(),this.manage_connections(),this.data._new_user=t,firebase.auth().signInWithCustomToken(this.data.auth_token).then(function(){u.data.logged=!0,u.data.ref_users.once("value",function(t){var e=t.val(),s=0,i=!1,a=0,n=!1,r=!1;if(null!==e){var o=Object.keys(e).length;d.each(e,function(t,e){a++,e&&("operator"===e.user_type&&"online"===e.status?u.valid_operator(e.vendor_id)&&(u.data.online_ops[e.user_id]=e):"operator"!==e.user_type&&(e.user_name!==f&&e.user_id!==u.opts.user_info.user_id&&s++,e.user_email!==f&&u.data.current_form.user_email!==f&&(e.user_email!==u.data.current_form.user_email||ylc.frontend_op_access||(e.user_ip!==u.opts.user_info.user_ip||"online"===e.status&&e.user_id!==u.opts.user_info.user_id?n=!0:r=e.conversation_id)))),n?u.display_ntf(u.strings.msg.already_logged,"error","#YLC_login_ntf"):a===o&&(u.total_online_ops()||r?"operator"===u.opts.user_info.user_type||"0"===ylc.max_guests||s<ylc.max_guests?(null!==l&&clearInterval(l),u.opts.display_login?u.show_login():u.show_cnv(!0)):(i=!0,u.show_offline(!0)):u.show_offline(),u.check_user(u.opts.user_info.user_id,i,r))})}else u.show_offline(),u.check_user(u.opts.user_info.user_id,!1);_&&_(i)})})["catch"](function(t){console.error(t.code,t.message),u.display_ntf(u.strings.msg.conn_err,"error","#YLC_login_ntf")})},logout:function(t){var e=this;this.data.user.user_id&&(e.data.ref_user.off(),e.data.ref_users.off(),e.data.ref_msgs.off()),d(".chat-body").hide(),d("#YLC_end_chat").show(),ylc.is_premium?e.trigger_premium("end_chat_frontend",t):(t&&e.clear_user_data(e.data.user.conversation_id),setTimeout(function(){e.be_offline(),e.minimize()},2e3)),e.objs.cnv.empty(),e.objs.popup_header.click(function(){e.minimize(),e.objs.popup_header.off("click")}),d(c).trigger("resize")},be_offline:function(){this.data.mode="offline",this.data.ref_user&&(this.data.ref_user.child("status").set("offline"),this.data.ref_user.child("last_online").set(firebase.database.ServerValue.TIMESTAMP)),this.check_mode(!0)},check_mode:function(t){var e=this.data.mode;if(t)this.show_connecting(),this.data.mode="offline";else if(this.total_online_ops())"offline"===e&&(d("#YLC_cnv_reply").removeClass("chat-disabled").removeAttr("disabled"),this.clean_ntf()),this.data.mode=this.opts.display_login&&"online"!==e?"login":"online";else{switch(e){case"login":this.show_offline();break;case"online":ylc.is_premium||(this.opts.display_login?(d("#YLC_cnv_reply").addClass("chat-disabled").attr("disabled","disabled"),this.display_ntf(this.strings.msg.no_op+"!","error","#YLC_popup_ntf")):this.show_offline())}this.data.mode="offline"}},show_offline:function(t){var i=this;this.data.mode="offline",i.objs.popup.parent().removeClass().addClass("chat-offline"),d(".chat-body").hide(),d("#YLC_offline .chat-lead").hide(),d("#YLC_offline").show(),t?(ylc.show_busy_form||d("#YLC_popup_form").hide(),d("#YLC_offline .chat-lead.op-busy").show(),null!==l&&clearInterval(l),l=setInterval(function(){i.data.ref_users.once("value",function(t){var e=t.val(),s=0;null!==e&&d.each(e,function(t,e){e&&e.user_name!==f&&"operator"!==e.user_type&&e.user_id!==i.opts.user_info.user_id&&s++}),s<ylc.max_guests&&(i.opts.display_login?i.login(!1):i.login(!0))})},3e4)):d("#YLC_offline .chat-lead.op-offline").show(),d(c).trigger("resize")},show_connecting:function(){d(".chat-body").hide(),d("#YLC_connecting").show()},show_login:function(){var e=this;this.opts.display_login&&this.total_online_ops()&&this.objs.popup?(this.data.mode="login",this.objs.popup.parent().removeClass().addClass("chat-login"),d(".chat-body").hide(),d("#YLC_login").show(),d(c).trigger("resize"),d("#YLC_login_btn").hover(function(){d(this).css("background-color",e.data.primary_hover)},function(){d(this).css("background-color",e.opts.styles.bg_color)}).click(function(){e.send_login_form()}),d("#YLC_login_form").keydown(function(t){13!==t.keyCode||t.shiftKey||(t.preventDefault(),e.send_login_form())})):"online"===e.data.mode?this.show_cnv():this.show_offline()},send_login_form:function(){var s=this;if(ylc.chat_gdpr&&!d("#YLC_chat_gdpr_acceptance").is(":checked"))return s.display_ntf(s.strings.msg.field_empty,"error","#YLC_login_ntf"),!1;this.display_ntf(this.strings.msg.connecting+"...","sending","#YLC_login_ntf");var t=d("#YLC_login_form").serializeArray(),i=t.length-1;d.each(t,function(t,e){if(s.data.current_form[e.name]=e.value,!e.value)return s.display_ntf(s.strings.msg.field_empty,"error","#YLC_login_ntf"),!1;if("user_email"===e.name){if(!s.validate_email(e.value))return s.display_ntf(s.strings.msg.invalid_email,"error","#YLC_login_ntf"),!1;s.data.current_form.gravatar=s.md5(e.value)}else if(!s.validate_username(e.value))return s.display_ntf(s.strings.msg.invalid_username,"error","#YLC_login_ntf"),!1;t===i&&setTimeout(function(){s.login(!0)},1e4)})},check_user:function(s,t,i){var a=this;this.data.ref_user=this.data.ref_users.child(s),t?this.data.ref_user.child("status").set("wait"):(this.data.ref_user.once("value",function(t){var e=t.val();e=e||{},a.get_user(s,e,i)}),this.data.ref_user.child("chat_with").on("value",function(t){var e=t.val();null!==e&&(a.data.user.chat_with=e)})),this.data.ref_users.on("child_removed",function(t){var e=t.val();e&&s===e.user_id&&a.logout()})},get_user:function(t,e,s,i){var a=this;if(e.user_id)this.data.user=e,this.data.ref_user.child("status").set("online"),this.data.ref_user.child("user_ip").set(a.opts.user_info.user_ip),this.data.ref_user.child("current_page").set(a.opts.user_info.current_page),this.data.ref_user.child("vendor_id").set(ylc.active_vendor.vendor_id),this.data.ref_user.child("vendor_name").set(ylc.active_vendor.vendor_name),this.data.ref_user.child("chat_with").set("free"),this.total_online_ops()?this.show_cnv():this.show_offline(),this.manage_connections(),a.listen_users(),i&&i();else if(!0===this.data._new_user){var n={user_id:t,conversation_id:this.data.ref_cnv.push({user_id:t,created_at:firebase.database.ServerValue.TIMESTAMP,accepted_at:"",evaluation:"",user_type:"visitor",receive_copy:!1}).key,last_online:"",is_mobile:this.data.is_mobile,chat_with:"free",status:"online",vendor_id:ylc.active_vendor.vendor_id,vendor_name:ylc.active_vendor.vendor_name};for(var r in this.opts.user_info)n[r]=this.opts.user_info[r];for(var o in this.data.current_form)n[o]=this.data.current_form[o];n.user_name||(n.user_email?n.user_name=n.user_email.substring(0,n.user_email.indexOf("@")):n.user_name=this.data.guest_prefix+this.random_id(1e3,5e3)),this.data.user=n,this.data.ref_user.set(n,function(t){if(!t&&(a.show_cnv(),a.manage_connections(),a.listen_users(),s))if(ylc.is_premium){var e=new Date;a.trigger_premium("save_user_data",s,!0,e.getTime(),!1)}else a.clear_user_data(s);i&&i()})}else a.listen_users()},show_cnv:function(t){var e=this;this.data.mode="online",this.objs.popup.parent().removeClass().addClass("chat-online"),d(".chat-body").hide(),d("#YLC_chat_body").show(),this.objs.cnv=d("#YLC_cnv"),t?setTimeout(function(){d("#YLC_cnv_reply").focus().autosize({append:""}).trigger("autosize.resize")},this.data.animation_delay):d("#YLC_cnv_reply").focus().autosize({append:""}).trigger("autosize.resize"),d(c).trigger("resize"),this.listen_msgs(),d("#YLC_tool_end_chat").click(function(){e.push_msg("-- "+e.strings.msg.close_msg_user+" --"),e.data.ref_cnv.child(e.data.user.conversation_id).child("status").set("closed"),e.logout(!0)}),this.manage_reply_box()},listen_users:function(){var a=this;this.data.last_changed_id=null,this.data.ref_users.once("value",function(t){var e=t.val(),s=0;if(null!==e){var i=Object.keys(e).length;a.data.online_ops={},d.each(e,function(t,e){s+=1,e&&a.valid_operator(e.vendor_id)&&"operator"===e.user_type&&("online"===e.status?a.data.online_ops[e.user_id]=e:delete a.data.online_ops[e.user_id]),s===i&&(a.check_mode(),a.listen_new_users())})}})},listen_new_users:function(){var s=this;this.data.ref_users.on("value",function(t){var e=t.val();d.each(e,function(t,e){s.update_user(e)})})},update_user:function(t,e){t&&!t.user_id||(t&&(t.conversation_id?("operator"===t.user_type&&("online"===t.status?this.data.online_ops[t.user_id]=t:delete this.data.online_ops[t.user_id]),this.check_mode()):this.clean_user_data(t.user_id)),this.data.last_changed_id=e)},clean_user_data:function(s){var i=this,a=this.data.ref_users.child(s);a.once("value",function(t){var e=t.val();a.remove(),e.conversation_id&&i.ref_cnv.child(e.conversation_id),i.data.ref_msgs.once("value",function(t){var e=t.val();e&&d.each(e,function(t,e){e.user_id===s&&i.data.ref_msgs.child(t).remove()})})})},set_avatar:function(t,e){return t="operator"===t?"admin":"user",ylc.is_premium?this.trigger_premium("set_avatar_premium",t,e):this.data.assets_url+"/images/default-avatar-"+t+".png"},time:function(t,e){return this.strings.time[t]&&this.strings.time[t].replace(/%d/i,Math.abs(Math.round(e)))},timeago:function(t){if(!t)return"";var e=.001*((new Date).getTime()-t)>>0,s=e/60,i=s/60,a=i/24,n=a/365;return(e<45&&this.time("seconds",e)||e<90&&this.time("minute",1)||s<45&&this.time("minutes",s)||s<90&&this.time("hour",1)||i<24&&this.time("hours",i)||i<42&&this.time("day",1)||a<30&&this.time("days",a)||a<45&&this.time("month",1)||a<365&&this.time("months",a/30)||n<1.5&&this.time("year",1)||this.time("years",n))+" "+this.strings.time.suffix},listen_msgs:function(){var a=this;this.data.ref_msgs.off(),this.data.ref_msgs.once("value",function(t){var e=t.val(),s=e?Object.keys(e).length:0,i=1;e?d.each(e,function(t,e){a.data.user.conversation_id===e.conversation_id&&(e.id=t,a.add_msg(e)),e.first_load=!0,s===i&&a.listen_new_msgs(t),i+=1}):a.listen_new_msgs()})},listen_new_msgs:function(t){var s=this,e=t?s.data.ref_msgs.startAt(null,t):s.data.ref_msgs,i=!0;t||(i=!1),e.on("child_added",function(t){var e=t.val();e.id=t.key,s.data.user.conversation_id===e.conversation_id&&(i||s.add_msg(e)),i||s.show_popup(),i=!1})},add_msg:function(t){var e=new Date,s=new Date(t.msg_time),i=s.getHours()+":"+(s.getMinutes()<10?"0":"")+s.getMinutes(),a=this.sanitize_msg(t.msg),n=s.toDateString()===e.toDateString()?i:s.getUTCDate()+" "+this.strings.months_short[s.getUTCMonth()]+", "+i;if(this.objs.cnv.find(".chat-welc").hide(),this.objs.cnv){var r=t.user_id===this.data.user.user_id?" chat-you":"",o=s.getUTCDate()+" "+this.strings.months[s.getUTCMonth()]+" "+s.getUTCFullYear()+" "+i,_=this.set_avatar(t.user_type,{gravatar:t.gravatar,avatar_type:t.avatar_type,avatar_image:t.avatar_image});this.objs.cnv.append('<div id="YLC_msg_'+t.id+'" class="chat-cnv-line'+r+'"><div title="'+o+'" class="chat-cnv-time">'+n+'</div><div class="chat-avatar"><img src="'+_+'" /></div><div class="chat-cnv-msg"><div class="chat-cnv-author">'+t.user_name+"</div>"+a+'</div></div><div class="chat-clear"></div>').scrollTop(this.objs.cnv.prop("scrollHeight"))}},sanitize_msg:function(t){var e,s,i,a,n={"&":"&amp;","<":"&lt;",">":"&gt;"};return a=/\n/gim,e=/(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim,s=/(^|[^\/])(www\.[\S]+(\b|$))/gim,i=/(([a-zA-Z0-9\-\_\.])+@[a-zA-Z\_]+?(\.[a-zA-Z]{2,6})+)/gim,t.replace(/[&<>]/g,function(t){return n[t]||t}).replace(a,"<br />").replace(e,'<a href="$1" target="_blank">$1</a>').replace(s,'$1<a href="http://$2" target="_blank">$2</a>').replace(i,'<a href="mailto:$1">$1</a>')},manage_reply_box:function(t){var s,a=this,i=!1,e=d("#YLC_cnv_reply"),n=(s=0,function(t,e){clearTimeout(s),s=setTimeout(t,e)});this.data.ref_cnv.child(this.data.user.conversation_id+"/typing").remove(),e.keydown(function(t){if(13!==t.keyCode||t.shiftKey){if(!i){switch(t.keyCode){case 18:case 16:case 9:case 8:case 224:case 17:case 91:case 93:return}a.data.ref_cnv.child(a.data.user.conversation_id+"/typing/"+a.data.user.user_id).set(a.data.user.user_name),i=!0}n(function(){a.data.ref_cnv.child(a.data.user.conversation_id+"/typing/"+a.data.user.user_id).remove(),i=!1},1300)}else{t.preventDefault();var e=d(this).val();e&&(d(this).val("").trigger("autosize.resize"),a.push_msg(e),a.data.ref_cnv.child(a.data.user.conversation_id+"/typing/"+a.data.user.user_id).remove())}}),t&&this.data.ref_cnv.child(t+"/typing").off(),this.data.ref_cnv.child(this.data.user.conversation_id+"/typing").on("value",function(t){var s=0,e=t.val(),i=e?Object.keys(e).length:0;e?d.each(e,function(t,e){null===t||t===a.data.user.user_id?(i===s&&a.clean_ntf(),s+=1):a.display_ntf(a.strings.msg.writing.replace(/%s/i,e),"typing","#YLC_popup_ntf")}):a.clean_ntf()}),this.objs.popup.find(".chat-cnv-reply").click(function(){e.focus()})},reload_cnv:function(s){this.data.ref_msgs.once("value",function(t){var e=t.val();e&&d.each(e,function(t,e){e.conversation_id===s&&(e.old_msg=!0,0)})})},push_msg:function(t){this.data.ref_msgs.push({user_id:this.data.user.user_id,user_type:this.data.user.user_type,conversation_id:this.data.user.conversation_id,user_name:this.data.user.user_name||this.data.user.user_email,gravatar:this.data.user.gravatar,avatar_type:this.data.user.avatar_type,avatar_image:this.data.user.avatar_image,msg:t,msg_time:firebase.database.ServerValue.TIMESTAMP,vendor_id:ylc.active_vendor.vendor_id,read:!1})},get_user_data:function(t,s){this.data.ref_users.child(t).once("value",function(t){var e=t.val();s(e)})},render_chat:function(){var l=this;this.data.primary_fg=this.use_white(this.opts.styles.bg_color)?"#ffffff":"#444444",this.data.primary_hover=this.shade_color(this.opts.styles.bg_color,7),this.objs.btn=d("#YLC_chat_btn"),this.objs.btn.hover(function(){if(d(this).css("background-color",l.data.primary_hover),"round"===l.opts.styles.btn_type&&ylc.button_animation){var t=d(this).css("width","auto").width();d(this).width(l.opts.styles.btn_width).animate({width:t+10},250)}},function(){d(this).css("background-color",l.opts.styles.bg_color),"round"===l.opts.styles.btn_type&&ylc.button_animation&&d(this).animate({width:l.opts.styles.btn_width},250)}),this.objs.btn.click(function(){d(this).hide(),l.show_popup(),l.auth()}),setTimeout(function(){l.show_btn()},this.data.show_delay),this.show_connecting(),this.objs.popup=d("#YLC_chat"),this.objs.popup_header=d("#YLC_chat_header"),d(h).on("hover","#YLC_send_btn",function(){d(this).css("background-color",l.data.primary_hover)},function(){d(this).css("background-color",l.opts.styles.bg_color)}),d(c).resize(function(){var t=c,e=h.documentElement,s=h.getElementsByTagName("body")[0],i=t.innerHeight||e.clientHeight||s.clientHeight,a=l.objs.popup.height(),n=l.objs.popup_header.height(),r=parseInt(l.objs.popup.css("bottom"),10),o=a<i?"auto":i,_=a<i?"auto":i-n-r;l.objs.popup.css("height",o),d("#YLC_chat_body, #YLC_offline").css("height",_);var u=d(c).width();"round"===l.opts.styles.btn_type?l.objs.btn.css({width:l.opts.styles.btn_width+"px",left:"right"===l.opts.styles.x_pos?"auto":"20px",right:"left"===l.opts.styles.x_pos?"auto":"20px"}):480<u?l.objs.btn.css({width:l.opts.styles.btn_width+"px",left:"right"===l.opts.styles.x_pos?"auto":"40px",right:"left"===l.opts.styles.x_pos?"auto":"40px"}):l.objs.btn.css({width:"",left:"right"===l.opts.styles.x_pos?"auto":0,right:"left"===l.opts.styles.x_pos?"auto":0}),480<u?(l.objs.popup.css({left:"right"===l.opts.styles.x_pos?"auto":"40px",right:"left"===l.opts.styles.x_pos?"auto":"40px"}),d(".chat-body.chat-online").css("width",l.opts.styles.popup_width+"px"),d(".chat-body.chat-form").css("width",l.opts.styles.form_width+"px")):(l.objs.popup.css({left:"right"===l.opts.styles.x_pos?"auto":0,right:"left"===l.opts.styles.x_pos?"auto":0}),d(".chat-body").css("width",""))}).trigger("resize")},show_popup:function(){if("open"!==this.data.popup_status){var t=this;this.objs.popup.show(),this.animate(this.objs.popup,this.opts.styles.animation_type),setTimeout(function(){t.objs.popup_header.click(function(){t.be_offline(),t.minimize(),t.objs.popup_header.off("click")})},3e3),setTimeout(function(){switch(t.data.mode){case"online":d("#YLC_cnv_reply").focus(),t.objs.cnv.scrollTop(t.objs.cnv.prop("scrollHeight"));break;case"offline":case"login":d("#YLC_login_form .chat-line:first-child input").focus()}t.data.popup_status="open"},this.data.animation_delay)}},show_btn:function(t){this.objs.btn.show(),this.objs.btn.find(".chat-title").html(t),this.animate(this.objs.btn,this.opts.styles.animation_type)},minimize:function(){this.data.popup_status="close",this.objs.popup&&(this.objs.popup.hide(),this.show_connecting()),this.objs.btn.show(),this.animate(this.objs.btn,this.opts.styles.animation_type)},manage_connections:function(){var e=this;this.data.ref_user&&this.data.ref_conn.on("value",function(t){!0===t.val()?(e.data.ref_user.child("connections").push(!0).onDisconnect().remove(),e.data.ref_user.child("status").set("online"),e.data.ref_user.child("status").onDisconnect().set("offline"),e.data.ref_user.child("last_online").onDisconnect().set(firebase.database.ServerValue.TIMESTAMP),e.data.ref_cnv.child(e.data.user.conversation_id+"/typing/"+e.data.user.user_id).onDisconnect().remove()):e.show_offline()})},post:function(e,t,s){d.post(ylc.ajax_url+"?action="+e,t,s,"json").fail(function(t){return console.log(e,": ",t),!1})},trigger_premium:function(t,e,s,i,a,n,r){if(ylc.is_premium)return this.premium[t].call(this,e,s,i,a,n,r)},display_ntf:function(t,e,s){var i;switch(e){case"success":case"error":case"typing":i='<span class="ylc-icons ylc-icons-'+e+'"></span> ';break;default:i=""}d(s).removeClass().addClass("chat-ntf chat-"+e).html(i+t).fadeIn(300)},clean_ntf:function(){d(".chat-ntf").html("").hide()},clear_user_data:function(n,r){var o=this;this.data.ref_cnv.child(n).once("value",function(t){var e=t.val();if(e){var a=e.user_id;o.data.ref_msgs.once("value",function(t){var e=t.val(),s=e?Object.keys(e).length:0,i=0;e?d.each(e,function(t,e){i+=1,e.conversation_id===n&&o.data.ref_msgs.child(t).remove(),s===i&&r&&r()}):r&&r(),o.data.ref_users.child(a).remove(),o.data.ref_cnv.child(n).remove()})}})},total_online_ops:function(){return this.data.online_ops?Object.keys(this.data.online_ops).length:0},animate:function(t,e){d(c).trigger("resize");var s="top"===this.opts.styles.y_pos?"Down":"Up";t.addClass("chat-anim chat-"+e+s),setTimeout(function(){t.removeClass("chat-anim chat-"+e+s)},this.data.animation_delay)},shade_color:function(t,e){var s=parseInt(t.slice(1),16),i=Math.round(2.55*e),a=(s>>16)+i,n=(s>>8&255)+i,r=(255&s)+i;return"#"+(16777216+65536*(a<255?a<1?0:a:255)+256*(n<255?n<1?0:n:255)+(r<255?r<1?0:r:255)).toString(16).slice(1)},use_white:function(t){var e=t.substring(1),s=parseInt(e,16);return.2126*(s>>16&255)+.7152*(s>>8&255)+.0722*(s>>0&255)<180},validate_email:function(t){return/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(t)},validate_username:function(t){return/^[\u0030-\u0039\u0041-\u005A\u0061-\u007A\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u00FF\u0100-\u017F\u0180-\u024F\u0370-\u03FF\u0400-\u04FF\u0530-\u058F\u0590-\u05FF\u0600-\u06FF\u1100-\u11FF\u3130-\u318F\uAC00-\uD7AF\u2E80-\u2EFF\u3000-\u303F\u31C0-\u31EF\u3200-\u32FF\u3300-\u33FF\u3400-\u4DBF\u4E00-\u9FFF\uF900-\uFAFF\uFE30-\uFE4F\u3040-\u309F\u30A0-\u30FF\u31F0-\u31FF\u0020\u002D\u002E\u0040\u005F]+$/gim.test(t)},md5:function(t){function o(t,e){var s,i,a,n,r;return a=2147483648&t,n=2147483648&e,r=(1073741823&t)+(1073741823&e),(s=1073741824&t)&(i=1073741824&e)?2147483648^r^a^n:s|i?1073741824&r?3221225472^r^a^n:1073741824^r^a^n:r^a^n}function e(t,e,s,i,a,n,r){return t=o(t,o(o(e&s|~e&i,a),r)),o(t<<n|t>>>32-n,e)}function s(t,e,s,i,a,n,r){return t=o(t,o(o(e&i|s&~i,a),r)),o(t<<n|t>>>32-n,e)}function i(t,e,s,i,a,n,r){return t=o(t,o(o(e^s^i,a),r)),o(t<<n|t>>>32-n,e)}function a(t,e,s,i,a,n,r){return t=o(t,o(o(s^(e|~i),a),r)),o(t<<n|t>>>32-n,e)}function n(t){var e,s="",i="";for(e=0;e<=3;e++)s+=(i="0"+(i=t>>>8*e&255).toString(16)).substr(i.length-2,2);return s}var r,_,u,l,c,d,h,f,p;for(r=function(t){for(var e,s=t.length,i=16*(((e=s+8)-e%64)/64+1),a=Array(i-1),n=0,r=0;r<s;)n=r%4*8,a[e=(r-r%4)/4]|=t.charCodeAt(r)<<n,r++;return a[e=(r-r%4)/4]|=128<<r%4*8,a[i-2]=s<<3,a[i-1]=s>>>29,a}(t=function(t){t=t.replace(/\r\n/g,"\n");for(var e="",s=0;s<t.length;s++){var i=t.charCodeAt(s);i<128?e+=String.fromCharCode(i):(127<i&&i<2048?e+=String.fromCharCode(i>>6|192):(e+=String.fromCharCode(i>>12|224),e+=String.fromCharCode(i>>6&63|128)),e+=String.fromCharCode(63&i|128))}return e}(t)),d=1732584193,h=4023233417,f=2562383102,p=271733878,t=0;t<r.length;t+=16)d=e(_=d,u=h,l=f,c=p,r[t+0],7,3614090360),p=e(p,d,h,f,r[t+1],12,3905402710),f=e(f,p,d,h,r[t+2],17,606105819),h=e(h,f,p,d,r[t+3],22,3250441966),d=e(d,h,f,p,r[t+4],7,4118548399),p=e(p,d,h,f,r[t+5],12,1200080426),f=e(f,p,d,h,r[t+6],17,2821735955),h=e(h,f,p,d,r[t+7],22,4249261313),d=e(d,h,f,p,r[t+8],7,1770035416),p=e(p,d,h,f,r[t+9],12,2336552879),f=e(f,p,d,h,r[t+10],17,4294925233),h=e(h,f,p,d,r[t+11],22,2304563134),d=e(d,h,f,p,r[t+12],7,1804603682),p=e(p,d,h,f,r[t+13],12,4254626195),f=e(f,p,d,h,r[t+14],17,2792965006),d=s(d,h=e(h,f,p,d,r[t+15],22,1236535329),f,p,r[t+1],5,4129170786),p=s(p,d,h,f,r[t+6],9,3225465664),f=s(f,p,d,h,r[t+11],14,643717713),h=s(h,f,p,d,r[t+0],20,3921069994),d=s(d,h,f,p,r[t+5],5,3593408605),p=s(p,d,h,f,r[t+10],9,38016083),f=s(f,p,d,h,r[t+15],14,3634488961),h=s(h,f,p,d,r[t+4],20,3889429448),d=s(d,h,f,p,r[t+9],5,568446438),p=s(p,d,h,f,r[t+14],9,3275163606),f=s(f,p,d,h,r[t+3],14,4107603335),h=s(h,f,p,d,r[t+8],20,1163531501),d=s(d,h,f,p,r[t+13],5,2850285829),p=s(p,d,h,f,r[t+2],9,4243563512),f=s(f,p,d,h,r[t+7],14,1735328473),d=i(d,h=s(h,f,p,d,r[t+12],20,2368359562),f,p,r[t+5],4,4294588738),p=i(p,d,h,f,r[t+8],11,2272392833),f=i(f,p,d,h,r[t+11],16,1839030562),h=i(h,f,p,d,r[t+14],23,4259657740),d=i(d,h,f,p,r[t+1],4,2763975236),p=i(p,d,h,f,r[t+4],11,1272893353),f=i(f,p,d,h,r[t+7],16,4139469664),h=i(h,f,p,d,r[t+10],23,3200236656),d=i(d,h,f,p,r[t+13],4,681279174),p=i(p,d,h,f,r[t+0],11,3936430074),f=i(f,p,d,h,r[t+3],16,3572445317),h=i(h,f,p,d,r[t+6],23,76029189),d=i(d,h,f,p,r[t+9],4,3654602809),p=i(p,d,h,f,r[t+12],11,3873151461),f=i(f,p,d,h,r[t+15],16,530742520),d=a(d,h=i(h,f,p,d,r[t+2],23,3299628645),f,p,r[t+0],6,4096336452),p=a(p,d,h,f,r[t+7],10,1126891415),f=a(f,p,d,h,r[t+14],15,2878612391),h=a(h,f,p,d,r[t+5],21,4237533241),d=a(d,h,f,p,r[t+12],6,1700485571),p=a(p,d,h,f,r[t+3],10,2399980690),f=a(f,p,d,h,r[t+10],15,4293915773),h=a(h,f,p,d,r[t+1],21,2240044497),d=a(d,h,f,p,r[t+8],6,1873313359),p=a(p,d,h,f,r[t+15],10,4264355552),f=a(f,p,d,h,r[t+6],15,2734768916),h=a(h,f,p,d,r[t+13],21,1309151649),d=a(d,h,f,p,r[t+4],6,4149444226),p=a(p,d,h,f,r[t+11],10,3174756917),f=a(f,p,d,h,r[t+2],15,718787259),h=a(h,f,p,d,r[t+9],21,3951481745),d=o(d,_),h=o(h,u),f=o(f,l),p=o(p,c);return(n(d)+n(h)+n(f)+n(p)).toLowerCase()},random_id:function(t,e){return Math.floor(Math.random()*(e-t+1))+t},purge_firebase:function(s){var l=this;this.data.ref_users.once("value",function(t){var e=t.val(),i=0,a=[],n=[],r=[],o=s?0:3600;if(null!==e){var _=Object.keys(e).length,u=new Date;d.each(e,function(t,e){if(i++,e)if("offline"===e.status){var s=.001*(u.getTime()-e.last_online)>>0;o<=s&&("operator"!==e.user_type?null!==e.conversation_id?n.push(e.conversation_id):a.push(t):(a.push(t),r.push(e.conversation_id)))}else if("wait"===e.status)if(e.last_online===f)a.push(t);else{s=.001*(u.getTime()-e.last_online)>>0;2*o<=s&&a.push(t)}i===_&&(d.each(a,function(t,e){l.data.ref_users.child(e).remove()}),d.each(r,function(t,e){l.data.ref_cnv.child(e).remove()}),d.each(n,function(t,e){ylc.is_premium?l.trigger_premium("save_user_data",e,!0,u.getTime()):l.clear_user_data(e)}))})}})},valid_operator:function(t){return!ylc.yith_wpv_active||(!(!ylc.yith_wpv_active||ylc.active_vendor.vendor_id!==t)||!(!ylc.yith_wpv_active||"0"!==t||ylc.vendor_only_chat))}},d.fn[e]=function(){return this.each(function(){d.data(this,"plugin_"+e)||d.data(this,"plugin_"+e,new t(this))})},d(h).ready(function(){d.post(h.location.href,function(t){if(""!==t){var e=d("<div></div>").html(t).find("#YLC");d("#YLC").html(e.html()).YLC(),d('a[href="#yith-live-chat"]').click(function(t){t.preventDefault(),d("#YLC_chat_btn").click()})}})})}(jQuery,window,document);