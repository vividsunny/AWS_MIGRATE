/*
Part of the WordPress plugin Tag Groups
Plugin URI: https://chattymango.com/tag-groups/
Author: Christoph Amthor
License: GNU GENERAL PUBLIC LICENSE, Version 3
Last modified: 20190510
Created with: https://jscompress.com/
*/

function tg_do_ajax(b,m,v){var t={action:"tg_ajax_manage_groups",nonce:jQuery("#tg_nonce").val()};jQuery.extend(m,t),m.start_position=jQuery("#tg_start_position").val();var j="";jQuery.ajax({url:b.ajaxurl,data:m,dataType:"text",method:"post",success:function(t){try{var a=JSON.parse(t)}catch(t){j='<div class="notice notice-error"><p>Error loading groups. Please check <b>Tag Groups Settings -> Troubleshooting -> System Information -> Ajax Test</b></p></div><br clear="all" />',jQuery("#tg_message_container").fadeTo(500,0,function(){jQuery(this).html(j).fadeTo(800,1)})}var s=a.data,e=a.supplemental.message,n=a.supplemental.nonce,o=a.supplemental.task;if(""!==n&&jQuery("#tg_nonce").val(n),"success"===s){var l=a.supplemental.groups,r=a.supplemental.start_position;""!==r?jQuery("#tg_start_position").val(r):r=m.start_position;a.supplemental.end_position;var d=a.supplemental.max_number,p="",c=r;if(0<d)for(var _ in l){var g=l[_];null!=g.id&&(p+='<tr class="tg_sort_tr" data-position="'+c+'">\n',p+="<td>"+g.id+"</td>\n",p+='<td><span class="tg_edit_label tg_text" data-position="'+c+'" data-label="'+escape_html(g.label)+'">'+escape_html(g.label)+'<span class="dashicons dashicons-edit tg_pointer" style="display:none;"></span></span></td>\n',p+='<td class="tg_hide_when_drag"><div class="tg_term_amounts">',""!==b.tagsurl?p+='<a href="'+b.tagsurl+"&term-filter="+g.id+'" title="'+v.tooltip_showtags+'">'+g.amount+"</a>":p+=g.amount+"</span>",p+="</div>",p+='</td>\n<td class="tg_hide_when_drag">',""!==b.tagsurl&&(p+='<a href="'+b.tagsurl+"&term-filter="+g.id+'" title="'+v.tooltip_showtags+'"><span class="tg_pointer dashicons dashicons-tag"></span></a> '),""!==b.postsurl&&(p+='<a href="'+b.postsurl+"&post_status=all&tg_filter_posts_value="+g.id+'" title="'+v.tooltip_showposts+'"><span class="tg_pointer dashicons dashicons-admin-page"></span></a>'),p+='</td>\n<td class="tg_hide_when_drag">',p+='<span class="tg_delete tg_pointer dashicons dashicons-trash" data-position="'+c+'" title="'+v.tooltip_delete+'"></span>',p+='<span class="tg_pointer dashicons dashicons-plus-alt" title="'+v.tooltip_newbelow+'" onclick="tg_toggle_clear('+c+')" style="margin-left:5px;"></span>',p+="</td>\n",p+='<td class="tg_hide_when_drag">',p+='<div style="overflow:hidden; position:relative; height:20px; clear:both;">',1<c&&(p+='<span class="tg_up tg_pointer dashicons dashicons-arrow-up" data-position="'+c+'" title="'+v.tooltip_move_up+'""></span>'),p+="</div>",p+='<div style="overflow:hidden; position:relative; height:20px; clear:both;">',c<d&&(p+='<span class="tg_down tg_pointer dashicons dashicons-arrow-down" data-position="'+c+'" title="'+v.tooltip_move_down+'"></span>'),p+="</div>",p+="</td>\n",p+="</tr>\n",p+='<tr style="display:none; height:45px; background-color:#FFC;" id="tg_new_'+c+'">\n',p+='<td style="display:none;">'+v.newgroup+"</td>\n",p+='<td colspan="4" style="display:none;"><input data-position="'+c+'"  placeholder="'+v.placeholder_new+'">',p+='<span class="tg_new_yes dashicons dashicons-yes tg_pointer" data-position="'+c+'"></span> <span class="tg_new_no dashicons dashicons-no-alt tg_pointer" data-position="'+c+'" onclick="tg_toggle_clear('+c+')"></span>',p+="</td>\n",p+="</tr>\n",c++)}else p+='<tr id="tg_new_1">\n',p+="<td ></td>\n",p+='<td colspan="4"><input data-position="0" placeholder="'+v.newgroup+'">',p+='<span class="tg_new_yes dashicons dashicons-yes tg_pointer" data-id="1"></span></span>',p+="</td>\n",p+="</tr>\n";"move"==o?jQuery("#tg_groups_container").html(p):jQuery("#tg_groups_container").fadeOut(300,function(){jQuery(this).html(p).fadeIn(300)});var u,h,f="",y=Number(b.items_per_page);for(y<1&&(y=1),h=Math.floor(r/y)+1,max_page=Math.floor((d-1)/y)+1,f+=1<h?'<button class="button-secondary tg_pager_button" data-page="'+(h-1)+'"><span class="dashicons dashicons-arrow-left-alt2"></span></button>':'<button class="button-secondary tg_pager_button" disabled><span class="dashicons dashicons-arrow-left-alt2"></span></button>',i=1;i<=d;i+=y)u=Math.floor(i/y)+1,f+=u==h?'<button class="tg_reload_button tg_pointer button-secondary" id="tg_groups_reload" title="'+v.tooltip_reload+'"><span class="dashicons dashicons-update"></span></button>':'<button class="button-secondary tg_pager_button" data-page="'+u+'"><span>'+u+"</span></button>";h<max_page?f+='<button class="button-secondary tg_pager_button" data-page="'+(h+1)+'"><span class="dashicons dashicons-arrow-right-alt2"></span></button>':f+='<button class="button-secondary tg_pager_button" disabled><span class="dashicons dashicons-arrow-right-alt2"></span></button>',jQuery("#tg_pager_container").fadeOut(200,function(){jQuery(this).html(f).fadeIn(400,function(){jQuery("#tg_pager_container_adjuster").css({height:Number(jQuery("#tg_pager_container").height())+10})})}),j+=""!=e?'<div class="notice notice-success"><p>'+e+'</p></div><br clear="all" />':'<div><p>&nbsp;</p></div><br clear="all" />',jQuery("#tg_message_container").fadeTo(500,0,function(){jQuery(this).html(j).fadeTo(800,1)})}else""==e&&(e="Error loading data.",console.log(t)),j+='<div class="notice notice-error"><p>'+e+'</p></div><br clear="all" />',jQuery("#tg_message_container").fadeTo(500,0,function(){jQuery(this).html(j).fadeTo(800,1)})},error:function(t,a,s){console.log("[Tag Groups] error: "+t.responseText)}})}function tg_close_textfield(t,a){var s,e=t.children(":first").attr("data-position");s=escape_html(a?t.children(":first").attr("value"):t.children(":first").attr("data-label")),t.replaceWith('<span class="tg_edit_label tg_text" data-position="'+e+'" data-label="'+s+'">'+s+' <span class="dashicons dashicons-edit tg_pointer" style="display:none;"></span></span>')}function tg_toggle_clear(t){var a=jQuery("#tg_new_"+t);a.is(":visible")?(jQuery("[data-position="+t+"]").val(""),a.children().fadeOut(300,function(){a.slideUp(600)})):(jQuery('[id^="tg_new_"]:visible').children().fadeOut(300,function(){jQuery('[id^="tg_new_"]:visible').slideUp(400)}),a.delay(500).slideDown(400,function(){a.children().fadeIn(300),jQuery("[data-position="+t+"]").focus()}))}function tg_close_all_textfields(){jQuery(".tg_edit_label_active").each(function(){tg_close_textfield(jQuery(this),!1)})}function escape_html(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}
