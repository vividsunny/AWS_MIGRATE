var array_unique_noempty,element_box;jQuery(function(o){var t={};o(".checkbox-column a").click(function(s){s.preventDefault();var e=o(this).attr("id").replace("-lnk",""),n=o(this).parent().parent().parent().parent(),a="."+e+"-cb";e in t&&!1!==t[e]?(n.find(a).prop("checked",!1),t[e]=!1):(n.find(a).prop("checked",!0),t[e]=!0)});var s=o("#ywsn_sms_gateway");function e(a){o("option",s).each(function(){var s=o("#"+o(this).val().toLowerCase()+"_title-description"),e=s.next("table"),n=s.prev("h2");o(this).val()===a?(s.show(),e.show(),n.show(),c(e,!0)):(s.hide(),e.hide(),n.hide(),c(e,!1))})}function n(s){var e=o("#ywsn_from_number"),n=o("#ywsn_from_asid");switch(s){case"YWSN_Jazz":case"YWSN_Trend_Mens":case"YWSN_Sabeq_Alarabia":case"YWSN_Bulk_SMS_SA":case"YWSN_Bulk_SMS":case"YWSN_Crystalwebtechs":case"YWSN_Mobily_WS":case"YWSN_Netpowers":case"YWSN_SMSAPI":case"YWSN_Uaedes":e.parent().parent().parent().hide(),e.prop("required",!1),n.parent().parent().parent().hide();break;default:e.parent().parent().parent().show(),e.prop("required",!0),n.parent().parent().parent().show()}}function c(s,e){o("input",s).each(function(){o(this).prop("required",e)})}void 0!==s&&(e(s.val()),n(s.val())),s.on("change",function(){e(s.val()),n(s.val())}),o(document).ready(function(){"use strict";o("#ywsn_sms_test_message").change(function(){var s=o("option:selected",this).val(),e=o(".ywsn-write-sms");"write-sms"===s?e.show():e.hide()}).change(),o(".ywsn-custom-message").on("change keyup input",function(){var s=o(this).val().length,e=ywsn_admin.sms_length-s,n=o(".ywsn-char-count");n.find("span").text(e),e<0?n.addClass("maxed-out"):n.removeClass("maxed-out")}),element_box.init()}),o("body").on("click","button.ywsn-send-test-sms",function(){var e=o(".ywsn-send-result"),s=o(".ywsn-test-sms").val(),n=o("#ywsn_sms_test_message_country").val(),a=o("#ywsn_sms_test_message").val(),t=o(".ywsn-sms-send-wrapper"),c="";if(t.addClass("processing"),t.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),e.show().removeClass("send-progress send-fail send-success"),""===a)return e.addClass("send-fail").html(ywsn_admin.sms_no_message),void t.removeClass("processing").unblock();switch(a){case"write-sms":c=o(".ywsn-custom-message").val();break;default:c=o("#ywsn_message_"+a).val()}if(""===c)return e.addClass("send-fail").html(ywsn_admin.sms_empty_message),void t.removeClass("processing").unblock();if(""===s)return e.addClass("send-fail").html(ywsn_admin.sms_wrong),void t.removeClass("processing").unblock();var i={action:"ywsn_send_sms",phone:s,message:c,country:n};e.addClass("send-progress").html(ywsn_admin.sms_before_send),o.post(ywsn_admin.ajax_url,i,function(s){e.removeClass("send-progress"),t.removeClass("processing").unblock(),!0===s.success?e.addClass("send-success").html(ywsn_admin.sms_after_send):e.addClass("send-fail").html(s.error)})}).on("click","button.ywsn-send-sms",function(){var e=o(".ywsn-send-result"),n=o(".ywsn-sms-metabox"),s=o("#_ywsn_receive_sms").is(":checked"),a=o(".ywsn-custom-message").val();if(n.addClass("processing").block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),"requested"!==ywsn_admin.sms_customer_notification||s||window.confirm(ywsn_admin.sms_manual_send_advice)){if(e.show().removeClass("send-progress send-fail send-success"),""===a)return e.addClass("send-fail").html(ywsn_admin.sms_empty_message),void n.removeClass("processing").unblock();var t={action:"ywsn_send_sms",object_id:o("#YWSN_object_id").val(),object_type:o("#YWSN_object_type").val(),message:a};e.addClass("send-progress").html(ywsn_admin.sms_before_send),o.post(ywsn_admin.ajax_url,t,function(s){e.removeClass("send-progress"),n.removeClass("processing").unblock(),!0===s.success?e.addClass("send-success").html(ywsn_admin.sms_after_send):e.addClass("send-fail").html(s.error),"booking"===o("#YWSN_object_type").val()?o("ul.booking-notes").prepend(s.note):o("ul.order_notes").prepend(s.note),o(".ywsn-custom-message").val(""),o(".ywsn-char-count span").text(ywsn_admin.sms_length)})}else n.removeClass("processing").unblock()}),array_unique_noempty=function(s){var n=[];return o.each(s,function(s,e){(e=o.trim(e))&&-1===o.inArray(e,n)&&n.push(e)}),n},element_box={clean:function(s){return s=s.replace(/\s*,\s*/g,",").replace(/,+/g,",").replace(/[,\s]+$/,"").replace(/^[,\s]+/,"")},parseTags:function(s){var e=s.id.split("-check-num-")[1],n=o(s).closest(".ywcc-checklist-div"),a=n.find(".ywcc-values"),t=a.val().split(","),c=[];return delete t[e],o.each(t,function(s,e){(e=o.trim(e))&&c.push(e)}),a.val(this.clean(c.join(","))),this.quickClicks(n),!1},quickClicks:function(s){var e,n=o(".ywcc-values",s),t=o(".ywcc-value-list ul",s),c=o(s).attr("id");n.length&&(e=n.val().split(","),t.empty(),o.each(e,function(s,e){var n,a;(e=o.trim(e))&&(n=o('<li class="select2-selection__choice" />'),(a=o('<span id="'+c+"-check-num-"+s+'" class="select2-selection__choice__remove" tabindex="0"></span>')).on("click keypress",function(s){"click"!==s.type&&13!==s.keyCode||(13===s.keyCode&&o(this).closest(".ywcc-checklist-div").find("input.ywcc-insert").focus(),element_box.parseTags(this))}),n.prepend(e).prepend(a),t.append(n))}))},flushTags:function(s,e,n){var a,t,c,i=o(".ywcc-values",s),r=o("input.ywcc-insert",s);return void 0===(c=(e=e||!1)?o(e).text():r.val())||(t=(a=i.val())?a+","+c:c,t=this.clean(t),t=array_unique_noempty(t.split(",")).join(","),i.val(t),this.quickClicks(s),e||r.val(""),void 0===n&&r.focus()),!1},init:function(){var s=o(".ywcc-checklist-ajax");o(".ywcc-checklist-div").each(function(){element_box.quickClicks(this)}),o("input.ywcc-insert",s).keyup(function(s){if(13===s.which)return element_box.flushTags(o(this).closest(".ywcc-checklist-div")),!1}).keypress(function(s){if(13===s.which)return s.preventDefault(),!1})}}});