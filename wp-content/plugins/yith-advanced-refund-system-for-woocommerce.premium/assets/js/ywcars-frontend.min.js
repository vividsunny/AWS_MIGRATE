jQuery(function(e){e(document).ready(function(o){o("#ywcars_form_my_account_new_message").on("submit",function(e){e.preventDefault(),o("div.ywcars_alert").hide();var a=o("div.ywcars_view_request"),r=o("textarea#ywcars_new_message"),t=o("input#ywcars_request_id").val();if(r.val()&&t){form_data=new FormData(this),fields_filled=!0,form_data.append("action","ywcars_submit_message"),form_data.append("security",localize_js_ywcars_frontend.ywcars_submit_message),form_data.append("request_id",t);var s={type:"POST",url:localize_js_ywcars_frontend.ajax_url,data:form_data,success:function(e,a,t){e.success&&"ywcars_message_submitted_correctly"==e.data?(o("div.ywcars_success_alert").show().find("span.ywcars_alert_content").text(localize_js_ywcars_frontend.success_message),r.val("")):o("div.ywcars_error_alert").show().find("span.ywcars_alert_content").text(e.data)},error:function(e,a,t){o("div.ywcars_error_alert").show().find("span.ywcars_alert_content").text(t)},complete:function(){a.unblock(),o("span.ywcars_update_messages").trigger("click")},cache:!1,contentType:!1,processData:!1};a.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),o.ajax(s)}else o("div.ywcars_error_alert").show().find("span.ywcars_alert_content").text(localize_js_ywcars_frontend.fill_fields)}),o(".ywcars_close_alert").on("click",function(){o(this).closest("div.ywcars_alert").hide()}),o("span.ywcars_update_messages").on("click",function(e){e.preventDefault();var a=o("input#ywcars_request_id").val(),t=o("div.ywcars_messages_history_frame"),r=o("div#ywcars_message_history");if(a){var s={action:"ywcars_update_messages",security:localize_js_ywcars_frontend.ywcars_update_messages,request_id:a};r.block({message:localize_js_ywcars_frontend.reloading,overlayCSS:{background:"#fff",opacity:.6}}),t.block({message:null,overlayCSS:{background:"#fff",opacity:.6}}),o.post(localize_js_ywcars_frontend.ajax_url,s,function(e){t.empty(),t.prepend(e),r.unblock(),t.unblock()})}}),o(".ywcars_button_refund").each(function(e,a){o(a).prettyPhoto({hook:"data-rel",social_tools:!1,theme:"pp_woocommerce",horizontal_padding:20,opacity:.8,deeplinking:!1,modal:!0,keyboard_shortcuts:!1,changepicturecallback:function(){o(document.body).trigger("ywcars_request_window_created")}})}),o(document.body).on("ywcars_request_window_created",function(){o(document.body).trigger("scroll.prettyphoto"),request_window_content=o("div.pp_content_container"),request_window_close_button=o("a.pp_close"),submit_button=o("#ywcars_submit_button"),o(".ywcars_close_alert").on("click",function(){o(this).closest("div.ywcars_alert").hide()}),o("#ywcars_form").on("submit",function(e){e.preventDefault(),o("div.ywcars_message").hide(),form_data=new FormData(this),fields_filled=!0,form_data.append("action","ywcars_submit_request"),form_data.append("security",localize_js_ywcars_frontend.ywcars_submit_request),whole_order=o("input[name='ywcars_form_whole_order']").val();var a={type:"POST",url:localize_js_ywcars_frontend.ajax_url,data:form_data,success:function(e){e.success&&"ywcars_request_created"==e.data?(submit_button.prop("disabled",!0),"current-url"==localize_js_ywcars_frontend.redirect_url?window.location.href=window.location.href:window.location.href=localize_js_ywcars_frontend.redirect_url):o("div.ywcars_error_alert").show().find("span.ywcars_alert_content").text(e.data)},error:function(e,a,t){o("div.ywcars_error_alert").show().find("span.ywcars_alert_content").text(t)},complete:function(){request_window_content.unblock(),request_window_close_button.show()},cache:!1,contentType:!1,processData:!1};if(reason=o("textarea[name='ywcars_form_reason']").val(),fields_filled=!!reason,whole_order||(qty=o("input[name='ywcars_form_qty']").val(),fields_filled=!(!qty||!reason)),fields_filled){request_window_content.block({message:null,overlayCSS:{background:"#f1f1f1",opacity:.7}}),request_window_close_button.hide();var t=form_data.get("ywcars_form_attachment[]");""===t.name&&""===t.type&&form_data.delete("ywcars_form_attachment[]"),o.ajax(a)}else o("div.ywcars_error_alert").show().find("span.ywcars_alert_content").text(localize_js_ywcars_frontend.fill_fields)})})})});