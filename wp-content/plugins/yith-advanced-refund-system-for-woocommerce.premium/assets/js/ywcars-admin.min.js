jQuery(function(a){a(document).ready(function(l){var i={init:function(){l(document.body).on("click","button.ywcars_accept_button",this.do_refund),l(document.body).on("click","button#ywcars_offer_coupon_button",this.create_coupon),l(document.body).on("click","button#ywcars_reject_request_button",this.reject),l(document.body).on("click","button#ywcars_processing_request_button",this.processing),l(document.body).on("click","button#ywcars_on_hold_request_button",this.on_hold),l(document.body).on("click","button#ywcars_close_request_button",this.close_request),l(document.body).on("click","#ywcars_submit_message",this.click_submit_message_button),l(document.body).on("submit","#post",this.submit_message),l(document.body).on("click","a.ywcars_update_messages",this.update_messages),l(document.body).on("click",".ywcars_close_alert",function(){l(this).closest("div.ywcars_alert").hide()}),this.check_disabled_buttons(),this.update_table_refund_total(),this.update_table_refund_subtotal(),this.custom_refund()},update_table_refund_total:function(){l(document.body).on("update_refund_total",function(){var a=l("td.ywcars_refund_total_data"),t=l("button span.amount"),e=0;l("input.ywcars_item_total").each(function(a){e+=parseFloat(l(this).val())}),e=accounting.formatNumber(e,ywcars_params.currency_format_num_decimals,""),l("#ywcars_refund_amount").val(e),l(this).trigger("check_disabled_buttons",e),e=accounting.formatMoney(e,{symbol:ywcars_params.currency_format_symbol,decimal:ywcars_params.currency_format_decimal_sep,thousand:ywcars_params.currency_format_thousand_sep,precision:ywcars_params.currency_format_num_decimals,format:ywcars_params.currency_format}),a.text(e),t.text(e)})},update_table_refund_subtotal:function(){var a=l('input[type="number"]'),t=l("input.ywcars_non_line_item_cb");a.change(function(){$row=l(this).closest("tr"),0<l(this).val()?$row.addClass("ywcars_items_table_highlight_single"):$row.removeClass("ywcars_items_table_highlight_single");var a=l("input#ywcars_restock_items"),t=a.closest("span").find("label");l(".ywcars_items_table_highlight_single").length?(a.prop("disabled",!1),t.css("color","#444")):(a.prop("checked",!1),a.prop("disabled",!0),t.css("color","gainsboro"));var e=$row.find("td.ywcars_item_data"),r=l("#ywcars_taxes_enabled").val(),s=parseFloat(e.find("input.ywcars_item_value").val()),c=parseFloat(e.find("input.ywcars_item_tax_value").val()),n=parseInt(e.find("input.ywcars_item_qty").val()),o=r?(s+c)*n:s*n;e.find("input.ywcars_item_total").val(o),$row.find("td.ywcars_refund_subtotal_data").text(accounting.formatMoney(o,{symbol:ywcars_params.currency_format_symbol,decimal:ywcars_params.currency_format_decimal_sep,thousand:ywcars_params.currency_format_thousand_sep,precision:ywcars_params.currency_format_num_decimals,format:ywcars_params.currency_format})),l(this).trigger("update_refund_total")}).change(),t.change(function(){$row=l(this).closest("tr");var a=$row.find("td.ywcars_non_line_item_data"),t=l("#ywcars_taxes_enabled").val(),e=parseFloat(a.find("input.ywcars_item_value").val()),r=parseFloat(a.find("input.ywcars_item_tax_value").val()),s=$row.find("td.ywcars_refund_subtotal_data"),c=0;l(this).is(":checked")?($row.addClass("ywcars_items_table_highlight_single"),c=t?e+r:e,s.text(accounting.formatMoney(c,{symbol:ywcars_params.currency_format_symbol,decimal:ywcars_params.currency_format_decimal_sep,thousand:ywcars_params.currency_format_thousand_sep,precision:ywcars_params.currency_format_num_decimals,format:ywcars_params.currency_format}))):($row.removeClass("ywcars_items_table_highlight_single"),c=0,s.text("")),a.find("input.ywcars_item_total").val(c),l(this).trigger("update_refund_total")}).change(),l("input#ywcars_restock_items").prop("checked",!0)},custom_refund:function(){var s=l(".ywcars_custom_refund_amount"),c=l("button span.amount");s.on("keyup",function(a){var t=l("td.ywcars_refund_total_data"),e=accounting.unformat(s.val(),ywcars_params.mon_decimal_point);e=accounting.formatNumber(e,ywcars_params.currency_format_num_decimals,""),l(this).trigger("check_disabled_buttons",e),l("#ywcars_refund_amount").val(e);var r=accounting.formatMoney(e,{symbol:ywcars_params.currency_format_symbol,decimal:ywcars_params.currency_format_decimal_sep,thousand:ywcars_params.currency_format_thousand_sep,precision:ywcars_params.currency_format_num_decimals,format:ywcars_params.currency_format});c.text(r),t.text(r)})},check_disabled_buttons:function(){l(document.body).on("check_disabled_buttons",function(a,t){var e=l("button.ywcars_request_action_button"),r=l("#ywcars_api_refund_button"),s=l("#ywcars_offer_coupon_button"),c=l("button#ywcars_reject_request_button"),n=l("button#ywcars_processing_request_button"),o=l("button#ywcars_on_hold_request_button"),_=!!l("input#ywcars_request_is_closed").val(),i=l("#ywcars_request_status").val(),u=parseFloat(l("input#ywcars_order_total").val());_||t<=0||u<t?e.prop("disabled",!0):(e.prop("disabled",!1),r.hasClass("disabled")&&r.prop("disabled",!0)),"ywcars-coupon"==i&&s.prop("disabled",!0),"ywcars-rejected"==i&&c.prop("disabled",!0),"ywcars-processing"==i&&n.prop("disabled",!0),"ywcars-on-hold"==i&&o.prop("disabled",!0)}),l(document.body).trigger("check_disabled_buttons")},do_refund:function(a){if(a.preventDefault(),i.block(),window.confirm(ywcars_params.i18n_do_refund)){var t=l("input#ywcars_request_id").val(),e=l("input#ywcars_order_id").val(),r=l("input#ywcars_refund_amount").val(),s=l("input#refunded_amount").val(),c={},n={},o={};l("tr.ywcars_items_table_highlight_single td.ywcars_item_data, tr.ywcars_items_table_highlight_single td.ywcars_non_line_item_data").each(function(a,t){item_id=l(t).find(".ywcars_item_id").val(),item_qty=parseInt(l(t).find(".ywcars_item_qty").val()),item_value=parseFloat(l(t).find(".ywcars_item_value").val()),item_total=item_qty?item_value*item_qty:item_value,item_qty&&(c[item_id]=item_qty),n[item_id]=accounting.unformat(item_total,ywcars_params.mon_decimal_point),o[item_id]={},item_taxes=l(t).find(".ywcars_item_tax").each(function(a,t){var e=l(t).data("tax_id"),r=item_qty?parseFloat(t.value)*item_qty:parseFloat(t.value);o[item_id][e]=accounting.unformat(r,ywcars_params.mon_decimal_point)})});var _={action:"woocommerce_refund_line_items",ywcars_request_id:t,order_id:e,refund_amount:r,refunded_amount:s,refund_reason:"",line_item_qtys:JSON.stringify(c,null,""),line_item_totals:JSON.stringify(n,null,""),line_item_tax_totals:JSON.stringify(o,null,""),api_refund:l(this).is(".do-api-refund"),restock_refunded_items:l("#ywcars_restock_items:checked").length?"true":"false",security:ywcars_params.order_item_nonce};l.post(ywcars_params.ajax_url,_,function(a){!0===a.success?(i.unblock(),window.location.reload()):(window.alert(a.data.error),i.unblock())})}else i.unblock()},create_coupon:function(a){a.preventDefault(),i.block();var t=l("input#ywcars_request_id").val(),e=l("input#ywcars_refund_amount").val(),r=accounting.formatMoney(e,{symbol:ywcars_params.currency_format_symbol,decimal:ywcars_params.currency_format_decimal_sep,thousand:ywcars_params.currency_format_thousand_sep,precision:ywcars_params.currency_format_num_decimals,format:ywcars_params.currency_format});if(window.confirm(ywcars_params.create_coupon+" "+r)){var s={action:"ywcars_create_coupon",ywcars_request_id:t,amount:e,security:ywcars_params.create_coupon_nonce};l.post(ywcars_params.ajax_url,s,function(a){!0===a.success?(i.unblock(),window.location.href=window.location.href):(window.alert(a.data.error),i.unblock())})}else i.unblock()},reject:function(a){a.preventDefault(),i.block();var t=l("input#ywcars_request_id").val();if(window.confirm(ywcars_params.reject)){var e={action:"ywcars_change_status",ywcars_request_id:t,ywcars_status:"ywcars-rejected",security:ywcars_params.change_status_nonce};l.post(ywcars_params.ajax_url,e,function(a){!0===a.success?(i.unblock(),window.location.href=window.location.href):(window.alert("Error: "+a.data.error),i.unblock())})}else i.unblock()},processing:function(a){a.preventDefault(),i.block();var t={action:"ywcars_change_status",ywcars_request_id:l("input#ywcars_request_id").val(),ywcars_status:"ywcars-processing",security:ywcars_params.change_status_nonce};l.post(ywcars_params.ajax_url,t,function(a){!0===a.success?(i.unblock(),window.location.href=window.location.href):(window.alert("Error: "+a.data.error),i.unblock())})},on_hold:function(a){a.preventDefault(),i.block();var t={action:"ywcars_change_status",ywcars_request_id:l("input#ywcars_request_id").val(),ywcars_status:"ywcars-on-hold",security:ywcars_params.change_status_nonce};l.post(ywcars_params.ajax_url,t,function(a){!0===a.success?(i.unblock(),window.location.href=window.location.href):(window.alert("Error: "+a.data.error),i.unblock())})},close_request:function(a){a.preventDefault(),i.block();var t=l("input#ywcars_request_id").val();if(window.confirm(ywcars_params.close_request)){var e={action:"ywcars_change_status",ywcars_request_id:t,ywcars_status:"ywcars-close-request",security:ywcars_params.change_status_nonce};l.post(ywcars_params.ajax_url,e,function(a){!0===a.success?(i.unblock(),window.location.href=window.location.href):(window.alert("Error: "+a.data.error),i.unblock())})}else i.unblock()},click_submit_message_button:function(a){a.preventDefault();l("#post").trigger("submit",!0)},submit_message:function(a){var r=l("textarea#ywcars_new_message"),t=l("input#ywcars_request_id").val();if(r.val()&&t){a.preventDefault(),form_data=new FormData(this),form_data.append("action","ywcars_submit_message"),form_data.append("security",ywcars_params.ywcars_submit_message),form_data.append("request_id",t);var e={type:"POST",url:ywcars_params.ajax_url,data:form_data,success:function(a,t,e){a.success&&"ywcars_message_submitted_correctly"==a.data?(l("div.ywcars_success_alert").show().find("span.ywcars_alert_content").text(ywcars_params.success_message),r.val("")):l("div.ywcars_error_alert").show().find("span.ywcars_alert_content").text(a.data)},error:function(a,t,e){l("div.ywcars_error_alert").show().find("span.ywcars_alert_content").text(e)},complete:function(){i.unblock_messages(),i.update_messages(a)},cache:!1,contentType:!1,processData:!1};i.block_messages({message:null,overlayCSS:{background:"#fff",opacity:.6}}),l.ajax(e)}else l("div.ywcars_error_alert").show().find("span.ywcars_alert_content").text(ywcars_params.fill_fields)},update_messages:function(a){a.preventDefault();var t=l("input#ywcars_request_id").val(),e=l("div.ywcars_messages_history_frame");if(t){var r={action:"ywcars_update_messages",security:ywcars_params.ywcars_update_messages,request_id:t};i.block_messages({message:null,overlayCSS:{background:"#fff",opacity:.6}}),l.post(ywcars_params.ajax_url,r,function(a){e.empty(),e.prepend(a),i.unblock_messages()})}},block:function(){l("#ywcars-items-metabox").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock:function(){l("#ywcars-items-metabox").unblock()},block_messages:function(){l("#ywcars-messages-metabox").block({message:null,overlayCSS:{background:"#fff",opacity:.6}})},unblock_messages:function(){l("#ywcars-messages-metabox").unblock()}},e={init:function(){l(document.body).on("woocommerce_variations_loaded",this.on_variations),l("input.ywcars_ndays_radio").change({selector:"._ywcars_ndays_refund_field"},e.hide_fields_on_radio_group).change(),l("input.ywcars_message_radio").change({selector:"._ywcars_message_field"},e.hide_fields_on_radio_group).change()},on_variations:function(){l(".ywcars_refunds_product_variations_data").each(function(a,t){l(t).find("input.ywcars_ndays_radio").change({selector:"._ywcars_ndays_refund_variation_field"},e.hide_fields_on_radio_group),l(t).find("input.ywcars_message_radio").change({selector:"._ywcars_message_variation_field"},e.hide_fields_on_radio_group)})},hide_fields_on_radio_group:function(a){var t=l(a.data.selector);"custom"==l(this).filter(":checked").val()?t.show():t.hide()}},a=function(){l(".ywcars_requests_toggle_button").on("click",function(a){a.preventDefault(),l(this).closest(".ywcars_requests_wrapper").find(".ywcars_single_request").not(".first").toggle(400)})};i.init(),e.init(),a()})});