jQuery(function(s){s(".tips").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:0}),s(".tips-top").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:0,defaultPosition:"top"}),s(".yith-wcmbs-tabs").tabs(),s(".yith-wcmbs-select2").select2(),s(".yith-wcmbs-color-picker").wpColorPicker(),s(".yith-wcmbs-date").datepicker({dateFormat:"yy-mm-dd"});var l=s("#yith-wcmbs-delay-time-for-plans-container"),t=s("#yith-wcmbs-hide-contents"),e=s("#yith-wcmbs-redirect-link").closest("tr"),i=s("#yith-wcmbs-products-in-membership-management"),a=s("#yith-wcmbs-download-link-position").closest("tr"),n=s("#yith-wcmbs-hide-price-and-add-to-cart").closest("tr"),o=function(){s(".yith-wcmbs-delay-number-input").length<1?l.hide():l.show()},r=s("#yith_wcmbs_restrict_access_plan");r.on("change",function(){var t,e,i=l.find("tr.yith-wcmbs-delay-row"),a=s(this).val(),n=[];for(var c in i.each(function(){var t=s(this).data("plan-id")+"";n.push(t),(null==a||a.indexOf(t)<0)&&s(this).remove()}),a){(0==n.length||0<n.length&&n.indexOf(a[c])<0)&&(e='<tr class="yith-wcmbs-delay-row" data-plan-id="'+(t=a[c])+'"><td><label for="yith-wcmbs-delay-'+t+'">'+r.find('option[value="'+t+'"]').html()+'</label></td><td><input class="yith-wcmbs-delay-number-input" data-plan-id="'+t+'" id="yith-wcmbs-delay-'+t+'" name="_yith_wcmbs_plan_delay['+t+']" type="number" value="0" min="0"></td></tr>',l.append(e))}o()}),o(),t.on("change",function(){2==s(this)[0].selectedIndex?e.show():e.hide()}),t.trigger("change"),i.on("change",function(){1==s(this)[0].selectedIndex?(a.show(),n.show()):(a.hide(),n.hide())}),i.trigger("change");var c=s("#yith-wcmbs-plan-item-order-container"),d=c.find("li").get(),h=s("#yith-wcmbs-plan-item-text"),m={message:null,overlayCSS:{background:"#000",opacity:.6},ignoreIfBlocked:!0};d.sort(function(t,e){var i=parseInt(s(t).attr("rel")),a=parseInt(s(e).attr("rel"));return i<a?-1:a<i?1:0}),s(d).each(function(t,e){c.append(e)}),c.sortable({items:"li",cursor:"move",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.8,revert:!0,stop:function(t,e){e.item.hasClass("yith-wcmbs-plan-item-text")&&e.item.find("input").focus()}}),h.draggable({connectToSortable:"#yith-wcmbs-plan-item-order-container",helper:"clone",revert:"invalid",stop:function(t,e){e.helper.html('<input type="text" name="_yith_wcmbs_plan_items[]" /><span class="dashicons dashicons-no-alt close"></span>'),e.helper.css({height:"auto"})}}),c.on("click",".close",function(t){s(t.target).closest("li").remove()}),c.find("li").disableSelection(),h.disableSelection(),c.on("click",".yith-wcmbs-delete-from-plan",function(t){var e=s(t.target),i=e.closest("li"),a=e.data("post-id"),n=e.data("plan-id");i.block(m),s.ajax({url:ajaxurl,type:"POST",data:{action:"yith_wcmbs_remove_plan_for_post",post_id:a,plan_id:n},success:function(t){console.log(t),i.unblock(),i.remove()}})}),c.on("click",".yith-wcmbs-hide-show-item",function(t){var e=s(t.target),i=e.closest("li").children("input.yith_wcmbs_hidden_item_ids"),a=(e.data("post-id"),"show");e.is(".dashicons-visibility")&&(a="hide"),"show"==a?(i.prop("disabled",!0),e.removeClass("dashicons-hidden").addClass("dashicons-visibility")):(i.prop("disabled",!1),e.removeClass("dashicons-visibility").addClass("dashicons-hidden"))}),s("#bulk_edit").on("click",function(){var t=s("#bulk-edit"),e=[];t.find("#bulk-titles").children().each(function(){e.push(s(this).attr("id").replace(/^(ttle)/i,""))});var i=s(".plans-checklist",t).find("input:checked"),a=[];i.each(function(){a.push(s(this).val())}),s.ajax({url:ajaxurl,type:"POST",async:!1,cache:!1,data:{action:"yith_wcmbs_save_bulk_edit",post_ids:e,yith_wcmbs_restrict_access_plan:a}})}),s(document).on("yith_wcmbs_select2_init",function(){var t=s(".yith_wcmbs_ajax_select2_select_customer");t.each(function(){var t={allowClear:!!s(this).data("allow_clear"),placeholder:s(this).data("placeholder"),minimumInputLength:s(this).data("minimum_input_length")?s(this).data("minimum_input_length"):"3",escapeMarkup:function(t){return t},ajax:{url:ajaxurl,dataType:"json",quietMillis:250,data:function(t){return{term:t.term,action:"woocommerce_json_search_customers",security:obj.customer_nonce,yith_wcmbs_show_username_only:!0}},processResults:function(t){var i=[];return t&&s.each(t,function(t,e){i.push({id:t,text:e})}),{results:i}},cache:!0}};s(this).select2(t)}),t.on("yith_wcmbs_select2_reset",function(){s(this).val("").trigger("change")}).trigger("yith_wcmbs_select2_reset")}).trigger("yith_wcmbs_select2_init"),s(".yith-wcmbs-select2-select-all").on("click",function(t){var e=s(t.target).data("container-id"),i=s("#"+e).find(".yith-wcmbs-select2").first();i.find("option").prop("selected",!0),i.trigger("change")}),s(".yith-wcmbs-select2-deselect-all").on("click",function(t){var e=s(t.target).data("container-id"),i=s("#"+e).find(".yith-wcmbs-select2").first();i.find("option:selected").removeAttr("selected"),i.trigger("change")}),s(document).on("click",".yith-wcmbs-copy-to-clipboard",function(t){var e,i=s(this).data("selector-to-copy"),a=s(i);0<a.length&&(e=s("<input>"),s("body").append(e),e.val(a.html()).select(),document.execCommand("copy"),e.remove())})});