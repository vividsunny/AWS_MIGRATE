jQuery(function(l){var n={message:null,overlayCSS:{background:"#000",opacity:.6},ignoreIfBlocked:!0};l.fn.yith_wcmbs_downloads_by_product=function(){var t=l(this);t.find("#yith-wcmbs-reports-table-downloads").data("order");t.on("yith_wcmbs_update_table",".yith-wcmbs-reports-download-reports-table",function(t){var e=l(t.target).closest(".yith-wcmbs-reports-download-reports-table"),a=e.find(".yith-wcmbs-reports-table-downloads").first(),o=a.data("order"),r={user_id:a.data("user-id"),order:o,action:"yith_wcmbs_get_download_table_reports"};e.block(n),l.ajax({type:"POST",data:r,url:ajaxurl,success:function(t){e.html(t)},complete:function(){e.unblock()}})}).on("click",".yith-wcmbs-reports-filter-button",function(t){var e=l(t.target).closest("#yith-wcmbs-reports-downloads-content-downloads-by-product"),a=e.find(".yith-wcmbs-reports-filter-user-id").first(),o=e.find(".yith-wcmbs-reports-download-reports-table").first();o.find(".yith-wcmbs-reports-table-downloads").first().data("user-id",a.val()),o.trigger("yith_wcmbs_update_table")}).on("click",".yith-wcmbs-reports-filter-reset",function(t){var e=l(t.target).closest("#yith-wcmbs-reports-downloads-content-downloads-by-product"),a=e.find(".yith-wcmbs-reports-filter-user-id").first(),o=e.find(".yith-wcmbs-reports-filter-button").first();a.trigger("yith_wcmbs_select2_reset"),o.trigger("click")}).on("click",".yith-wcmbs-reports-table-downloads-order-by-downloads",function(t){var e=l(t.target),a=(e.closest("#yith-wcmbs-reports-downloads-content-downloads-by-product"),e.closest(".yith-wcmbs-reports-download-reports-table"));a.find(".yith-wcmbs-reports-table-downloads").first().data("order",e.data("order")),a.trigger("yith_wcmbs_update_table")})},l("#yith-wcmbs-download-reports-downloads-by-product").yith_wcmbs_downloads_by_product(),l(document).on("click",".yith-wcmbs-reports-metabox h2",function(t){var e=l(t.target).closest(".yith-wcmbs-reports-metabox"),a=e.find(".yith-wcmbs-reports-content");"opened"==(e.hasClass("closed")?"closed":"opened")?(a.hide(),e.addClass("closed"),e.removeClass("opened")):(a.show(),e.addClass("opened"),e.removeClass("closed"))});var d=l(".yith-wcmbs-reports-downloads-menu"),i=l(".yith-wcmbs-reports-downloads-content-wrapper");l(d).on("click","a",function(t){t.preventDefault();var e=l(t.target).closest("a"),a=e.data("type");d.find("a").removeClass("active"),e.addClass("active"),l(".yith-wcmbs-reports-downloads-content").hide(),l("#yith-wcmbs-reports-downloads-content-"+a).show()}),l(d).on("click","span.close",function(t){t.preventDefault();var e=l(t.target).closest("span.close").closest("li"),a=e.find("a").first(),o=a.data("type");a.is(".active")&&d.find('a[data-type="downloads-by-user"]').trigger("click"),e.remove(),l("#yith-wcmbs-reports-downloads-content-"+o).remove()});var c=function(t,e){for(var a=t.split("&"),o=0;o<a.length;o++){var r=a[o].split("=");if(r[0]==e)return r[1]}return!1};l.fn.yith_wcmbs_ajax_table=function(){l(this).each(function(){var r,s=l(this),a=s.data("action"),o=s.find(".tablenav.top .tablenav-pages"),n=s.find(".tablenav.bottom .tablenav-pages"),d={message:null,overlayCSS:{background:"#000",opacity:.6},ignoreIfBlocked:!0},i={paged:"1",order:"DESC",orderby:"ID",per_page:"10"},i=l.extend(i,s.data());s.on("click",".tablenav-pages a, .manage-column.sortable a, .manage-column.sorted a",function(t){t.preventDefault();var e=this.search.substring(1),a=l.extend(i,{paged:c(e,"paged")||i.paged,order:c(e,"order")||i.order,orderby:c(e,"orderby")||i.orderby,per_page:c(e,"per_page")||i.per_page});s.trigger("update",a)}),s.on("change","input[name=paged]",function(t){13==t.which&&t.preventDefault();var e=s.find(".tablenav-pages a")[0].search.substring(1),a=s.find("input[name=paged]"),o=l.extend(i,{paged:parseInt(a.val())||i.paged,order:c(e,"order")||i.order,orderby:c(e,"orderby")||i.orderby,per_page:c(e,"per_page")||i.per_page});window.clearTimeout(r),r=window.setTimeout(function(){s.trigger("update",o)},500)}),s.on("click",".yith-wcmbs-ajax-table-apply-button",function(){var t=s.find(".yith-wcmbs-ajax-table-per-page").val(),e=l.extend(i,{per_page:t||c(query,"per_page")||i.per_page,paged:"1"});s.trigger("update",e)}),s.on("update",function(t,e){s.block(d),l.ajax({url:ajaxurl,data:l.extend({_yith_wcmbs_ajax_table_nonce:s.find("#_yith_wcmbs_ajax_table_nonce").val(),action:a},e),success:function(t){var e=l.parseJSON(t);e.rows.length&&s.find(".wp-list-table tbody").html(e.rows),e.column_headers.length&&s.find("thead tr, tfoot tr").html(e.column_headers),e.pagination.bottom.length&&o.html(l(e.pagination.top).html()),e.pagination.top.length&&n.html(l(e.pagination.bottom).html())},complete:function(){s.unblock(),s.find(".pagination-links").show(),s.find(".tips").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:0})}})})})},l(".yith-wcmbs-ajax-table").yith_wcmbs_ajax_table();var s=function(a,t,e){var o,r,s=d.find('a[data-type="downloads-by-user-'+a+'"]');s.length<1?(o=l('<li><a href="#" data-type="downloads-by-user-'+a+'">'+t+'</a> <span class="dashicons dashicons-no-alt close"></span> </li>'),d.append(o),r={action:"yith_wcmbs_get_download_reports_details_by_user_table",user_id:a},o.block(n),l.ajax({type:"POST",data:r,url:ajaxurl,success:function(t){i.append(t);var e=i.find("#yith-wcmbs-reports-downloads-content-downloads-by-user-"+a);e.find(".yith-wcmbs-ajax-table").yith_wcmbs_ajax_table(),e.find(".yith-wcmbs-tabs").tabs(),e.find(".tips-top").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:0,defaultPosition:"top"})},complete:function(){o.unblock(),e||d.find('a[data-type="downloads-by-user-'+a+'"]').trigger("click")}})):e||s.trigger("click")};l(document).on("click",".yith_wcmbs_download_reports_by_user .report_actions a.details",function(t){t.preventDefault();var e=l(t.target).closest("a.details"),a=e.data("user_id"),o=e.data("user_name"),r=t.ctrlKey;s(a,o,r)});var p=l("#yith-wcmbs-download-reports-downloads-details-by-user-search-select");l("#yith-wcmbs-download-reports-downloads-details-by-user-search-show-button").on("click",function(t){var e,a,o=p.val(),r=t.ctrlKey;o&&(a=(a=(e=!!(e=p.select2("data"))&&e[0])?e.text:"#"+o).substring(0,a.indexOf(" (")),console.log(o),console.log(a),console.log(r),s(o,a,r),p.val("").trigger("change"))})});